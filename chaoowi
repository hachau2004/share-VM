Æ°á»›c 1. Cáº­p nháº­t Ubuntu

Má»Ÿ terminal vÃ  cháº¡y:

sudo apt update


Má»¥c Ä‘Ã­ch: lÃ m má»›i danh sÃ¡ch gÃ³i pháº§n má»m trong kho Ubuntu.

ğŸ”¹ BÆ°á»›c 2. CÃ i cÃ´ng cá»¥ cÆ¡ báº£n
sudo apt install -y curl git docker.io


DÃ¹ng Ä‘á»ƒ táº£i file (curl), clone repo (git), vÃ  cháº¡y container (docker).

Kiá»ƒm tra:

curl --version
git --version
docker --version
XÃ³a báº£n cÅ© (x86_64) vá»«a táº£i
sudo rm /usr/local/lib/docker/cli-plugins/docker-compose

ğŸ”¹ 2ï¸âƒ£ Táº£i Ä‘Ãºng báº£n dÃ nh cho ARM64
sudo curl -fSL "https://github.com/docker/compose/releases/latest/download/docker-compose-linux-aarch64" \
  -o /usr/local/lib/docker/cli-plugins/docker-compose

ğŸ”¹ 3ï¸âƒ£ Cáº¥p quyá»n thá»±c thi
sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose

ğŸ”¹ 4ï¸âƒ£ Kiá»ƒm tra láº¡i
docker compose version


âœ… Náº¿u thÃ nh cÃ´ng, báº¡n sáº½ tháº¥y káº¿t quáº£ kiá»ƒu:

Docker Compose version v2.xx.x

âš ï¸ Náº¿u váº«n bÃ¡o lá»—i â€œunknown commandâ€

Cháº¡y thá»­:

docker --help | grep compose


Náº¿u khÃ´ng tháº¥y gÃ¬, khá»Ÿi Ä‘á»™ng láº¡i dá»‹ch vá»¥ Docker:

sudo systemctl restart docker


Rá»“i kiá»ƒm tra láº¡i lá»‡nh:

docker compose version


ğŸ”¹ BÆ°á»›c 3. CÃ i Docker Compose (v2)
sudo mkdir -p /usr/local/lib/docker/cli-plugins
sudo curl -fSL "https://github.com/docker/compose/releases/latest/download/docker-compose-linux-x86_64" \
  -o /usr/local/lib/docker/cli-plugins/docker-compose
sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose
docker compose version

ğŸ”¹ BÆ°á»›c 4. Cho phÃ©p cháº¡y Docker khÃ´ng cáº§n sudo
sudo usermod -aG docker $USER
newgrp docker

ğŸ”¹ BÆ°á»›c 5. CÃ i Node.js 22.x
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt-get install -y nodejs
nodejs -v
npm -v

ğŸ”¹ BÆ°á»›c 6. CÃ i Go 1.24.0
wget https://go.dev/dl/go1.24.0.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.24.0.linux-amd64.tar.gz
echo 'export GOROOT=/usr/local/go' >> ~/.bashrc
echo 'export GOPATH=$HOME/go' >> ~/.bashrc
echo 'export PATH=$PATH:$GOROOT/bin:$GOPATH/bin' >> ~/.bashrc
source ~/.bashrc
go version

FIX GO:
XÃ³a báº£n Go cÅ© bá»‹ sai kiáº¿n trÃºc:

sudo rm -rf /usr/local/go


2ï¸âƒ£ Táº£i Ä‘Ãºng báº£n Go 1.24.0 ARM64:

wget https://go.dev/dl/go1.24.0.linux-arm64.tar.gz


3ï¸âƒ£ Giáº£i nÃ©n vÃ  cáº¥u hÃ¬nh láº¡i:

sudo tar -C /usr/local -xzf go1.24.0.linux-arm64.tar.gz
echo 'export GOROOT=/usr/local/go' >> ~/.bashrc
echo 'export GOPATH=$HOME/go' >> ~/.bashrc
echo 'export PATH=$PATH:$GOROOT/bin:$GOPATH/bin' >> ~/.bashrc
source ~/.bashrc


4ï¸âƒ£ Kiá»ƒm tra láº¡i:

go version


âœ… Káº¿t quáº£ mong Ä‘á»£i:

go version go1.24.0 linux/arm64


ğŸ”¹ BÆ°á»›c 7. CÃ i Hyperledger Fabric 3.1.0 vÃ  CA 1.5.10
git clone https://github.com/hyperledger/fabric-samples.git
cd fabric-samples
curl -LO https://github.com/hyperledger/fabric/releases/download/v3.1.0/hyperledger-fabric-linux-amd64-3.1.0.tar.gz
tar -xzf hyperledger-fabric-linux-amd64-3.1.0.tar.gz -C .

curl -LO https://github.com/hyperledger/fabric-ca/releases/download/v1.5.10/hyperledger-fabric-ca-linux-amd64-1.5.10.tar.gz
tar -xzf hyperledger-fabric-ca-linux-amd64-1.5.10.tar.gz -C .

echo 'export PATH=$HOME/fabric-samples/bin:$PATH' >> ~/.bashrc
echo 'export FABRIC_CFG_PATH=$HOME/fabric-samples/config' >> ~/.bashrc
source ~/.bashrc

peer version
fabric-ca-client version

FIX PEER VERSION:
ğŸ”¹ 1ï¸âƒ£ XÃ³a báº£n cÅ© bá»‹ sai kiáº¿n trÃºc
rm -rf ~/fabric-samples/bin

ğŸ”¹ 2ï¸âƒ£ Táº£i Ä‘Ãºng báº£n cho ARM64

Hiá»‡n Hyperledger chÆ°a phÃ¡t hÃ nh binary chÃ­nh thá»©c cho ARM,
nhÆ°ng cÃ³ thá»ƒ cháº¡y báº±ng Docker ARM64 images, tá»©c lÃ  bá» qua pháº§n binary,
vÃ¬ cÃ¡c container (orderer, peer, CAâ€¦) Ä‘á»u cÃ³ image ARM64 sáºµn.

ğŸ‘‰ Táº£i bá»™ fabric-samples Ä‘Ãºng cÃ¡ch:

cd ~
rm -rf fabric-samples
git clone https://github.com/hyperledger/fabric-samples.git
cd fabric-samples

ğŸ”¹ 3ï¸âƒ£ KÃ©o vá» Docker image ARM64

Cháº¡y lá»‡nh nÃ y (thay cho viá»‡c cháº¡y peer trá»±c tiáº¿p):

docker pull hyperledger/fabric-peer:3.1
docker pull hyperledger/fabric-orderer:3.1
docker pull hyperledger/fabric-ca:1.5.10
docker pull hyperledger/fabric-tools:3.1

FIX DOCKER:
docker pull hyperledger/fabric-tools:2.5
ğŸ’¡ Sau khi táº£i xong, kiá»ƒm tra toÃ n bá»™ image:
bash
Sao chÃ©p mÃ£
docker images | grep hyperledger



CÃ¡c image nÃ y Ä‘á»u cÃ³ báº£n linux/arm64 â€” VirtualBox ARM sáº½ cháº¡y Ä‘Æ°á»£c.

ğŸ”¹ 4ï¸âƒ£ Sá»­a láº¡i biáº¿n mÃ´i trÆ°á»ng (chá»‰ giá»¯ pháº§n config)

KhÃ´ng cáº§n PATH trá» tá»›i bin/ ná»¯a:

echo 'export FABRIC_CFG_PATH=$HOME/fabric-samples/config' >> ~/.bashrc
source ~/.bashrc

ğŸ”¹ 5ï¸âƒ£ Kiá»ƒm tra Docker image
docker images | grep hyperledger


â†’ Náº¿u tháº¥y cÃ¡c dÃ²ng fabric-peer, fabric-orderer, fabric-ca lÃ  OK âœ…



âš™ï¸ PHáº¦N 2 â€“ LAB 4.1: Dá»±ng máº¡ng Bankchain
ğŸ”¹ BÆ°á»›c 1. Clone project Bankchain
cd ~/fabric-samples
git clone https://github.com/PacktPublishing/Blockchain-Development-for-Finance-Projects.git
cd Blockchain-Development-for-Finance-Projects/Chapter4/bankchain

FIX:
cd ~/fabric-samples/Blockchain-Development-for-Finance-Projects
ls

ğŸ”¹ BÆ°á»›c 2. Sinh chá»©ng chá»‰ sá»‘
cryptogen generate --config=./crypto-config.yaml --output=./crypto-config

FIXX:
CÃ¡ch kháº¯c phá»¥c lá»—i cryptogen: command not found
ğŸ§© BÆ°á»›c 1. Táº£i cÃ¡c binary cá»§a Hyperledger Fabric

Cháº¡y cÃ¡c lá»‡nh sau:

cd ~
curl -sSL https://bit.ly/2ysbOFE | bash -s


ğŸ”¹ Lá»‡nh nÃ y sáº½ táº£i vá» cÃ¡c cÃ´ng cá»¥ (tool binaries) cá»§a Fabric gá»“m:
cryptogen, configtxgen, peer, orderer, v.v.
VÃ  tá»± Ä‘á»™ng Ä‘áº·t chÃºng trong thÆ° má»¥c ~/fabric-samples/bin.

ğŸ§© BÆ°á»›c 2. ThÃªm vÃ o PATH

Sau khi táº£i xong, thÃªm dÃ²ng sau vÃ o file ~/.bashrc:

export PATH=$PATH:$HOME/fabric-samples/bin


Rá»“i cháº¡y láº¡i:

source ~/.bashrc

ğŸ§© BÆ°á»›c 3. Kiá»ƒm tra láº¡i

Cháº¡y:

cryptogen version


âœ… Náº¿u hiá»‡n ra thÃ´ng tin nhÆ°:

cryptogen:
 Version: 2.5.0
...


lÃ  Ä‘Ã£ OK.

Sau Ä‘Ã³, quay láº¡i thÆ° má»¥c bankchain vÃ  cháº¡y láº¡i lá»‡nh:

cd ~/fabric-samples/Blockchain-Development-for-Finance-Projects/Chapter\ 4/bankchain
cryptogen generate --config=./crypto-config.yaml --output=./crypto-config

ğŸ”¹ BÆ°á»›c 3. Sinh channel block
export FABRIC_CFG_PATH=$PWD
mkdir -p channel-artifacts
configtxgen -profile BankChannel -channelID bankchannel -outputBlock ./channel-artifacts/bankchannel.block

FIXXXX:
BÆ°á»›c 1 â€“ Kiá»ƒm tra láº¡i file configtx.yaml

Cháº¡y lá»‡nh sau trong thÆ° má»¥c bankchain:

cat configtx.yaml | grep Profile -A 5


Náº¿u khÃ´ng tháº¥y dÃ²ng:

Profiles:
    BankChannel:


â†’ thÃ¬ báº¡n Ä‘ang thiáº¿u Ä‘á»‹nh nghÄ©a profile BankChannel.

BÆ°á»›c 2 â€“ Má»Ÿ file configtx.yaml vÃ  thÃªm Ä‘oáº¡n sau á»Ÿ cuá»‘i (náº¿u chÆ°a cÃ³)

Má»Ÿ file:

nano configtx.yaml


Profiles:

    TwoOrgsOrdererGenesis:
        <<: *ChannelDefaults
        Orderer:
            <<: *OrdererDefaults
            Organizations:
                - *OrdererOrg
            Capabilities:
                <<: *OrdererCapabilities
        Consortiums:
            SampleConsortium:
                Organizations:
                    - *Org1
                    - *Org2

    TwoOrgsChannel:
        Consortium: SampleConsortium
        <<: *ChannelDefaults
        Application:
            <<: *ApplicationDefaults
            Organizations:
                - *Org1
                - *Org2
            Capabilities:
                <<: *ApplicationCapabilities

    BankChannel:
        Consortium: SampleConsortium
        <<: *ChannelDefaults
        Application:
            <<: *ApplicationDefaults
            Organizations:
                - *Org1
                - *Org2
            Capabilities:
                <<: *ApplicationCapabilities



(LÆ°u Ã½: â€œBankAâ€ vÃ  â€œBankBâ€ pháº£i trÃ¹ng vá»›i tÃªn Org trong pháº§n Organizations: á»Ÿ Ä‘áº§u file configtx.yaml.)

export FABRIC_CFG_PATH=$PWD

BÆ°á»›c 3 â€“ Cháº¡y láº¡i lá»‡nh
ğŸ§© 1ï¸âƒ£ Táº¡o genesis block:
configtxgen -profile TwoOrgsOrdererGenesis -channelID system-channel -outputBlock ./channel-artifacts/genesis.block

ğŸ§© 2ï¸âƒ£ Sau Ä‘Ã³ táº¡o channel block (BankChannel):
configtxgen -profile BankChannel -channelID bankchannel -outputCreateC
Sau khi lÆ°u file (Ctrl + O, Enter, Ctrl + X):

configtxgen -profile BankChannel -channelID bankchannel -outputBlock ./channel-artifacts/bankchannel.block

Fix:
configtxgen -profile TwoOrgsOrdererGenesis -channelID system-channel -outputBlock ./channel-artifacts/genesis.block
configtxgen -profile BankChannel -channelID bankchannel -outputCreateChannelTx ./channel-artifacts/bankchannel.tx


Náº¿u tháº¥y:

INFO Generated new channel genesis block

1. Táº¡o thÆ° má»¥c dummy nhÆ° hÆ°á»›ng dáº«n

Cháº¡y:

touch dummy_fabric
mkdir -p orderer-config

2. Sá»­a file docker-compose-bankchain.yaml

Má»Ÿ file:

nano docker-compose-bankchain.yaml


Trong pháº§n volumes cá»§a container (thÆ°á»ng lÃ  orderer hoáº·c cli), thÃªm 2 dÃ²ng sau:

      - ./dummy_fabric:/etc/hyperledger/fabric
      - ./orderer-config:/etc/hyperledger/orderer-cfg


LÆ°u láº¡i:
Ctrl + O â†’ Enter â†’ Ctrl + X

3. Cháº¡y láº¡i Docker Compose
docker compose -f docker-compose-bankchain.yaml up -d


â¡ï¸ Sau khi sá»­a Ä‘Ãºng, lá»—i invalid reference format sáº½ háº¿t vÃ  Docker sáº½ kÃ©o cÃ¡c image Fabric.

âœ… BÆ¯á»šC 5 â€” Kiá»ƒm tra cÃ¡c container Ä‘ang cháº¡y

Cháº¡y:

docker ps


Pháº£i tháº¥y cÃ¡c container orderer, peer0.banka, peer0.bankb, cli Ä‘ang â€œUpâ€.

ğŸªª PHáº¦N 3 â€“ LAB 4.2: Táº¡o danh tÃ­nh cho cÃ¡c ngÃ¢n hÃ ng
npm i fabric-ca-client fabric-network
node enrollAdmin-BankA.js
node registerUser-BankA.js
node enrollAdmin-BankB.js
node registerUser-BankB.js
ls wallet-BankA/
ls wallet-BankB/


Káº¿t quáº£: 2 thÆ° má»¥c wallet chá»©a danh tÃ­nh admin vÃ  user cho 2 ngÃ¢n hÃ ng.


version: '2'

networks:
  bankchain:

services:

  orderer.example.com:
    image: hyperledger/fabric-orderer:2.5
    container_name: orderer.example.com
    environment:
      - ORDERER_GENERAL_LOGLEVEL=info
      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0
      - ORDERER_GENERAL_GENESISMETHOD=file
      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block
      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP
      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp
    working_dir: /opt/gopath/src/github.com/hyperledger/fabric
    command: orderer
    ports:
      - 7050:7050
    volumes:
      - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block
      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp
    networks:
      - bankchain

  peer0.banka.example.com:
    container_name: peer0.banka.example.com
    image: hyperledger/fabric-peer:2.5
    environment:
      - CORE_PEER_ID=peer0.banka.example.com
      - CORE_PEER_ADDRESS=peer0.banka.example.com:7051
      - CORE_PEER_LISTENADDRESS=0.0.0.0:7051
      - CORE_PEER_CHAINCODEADDRESS=peer0.banka.example.com:7052
      - CORE_PEER_LOCALMSPID=BankAMSP
    volumes:
      - ./crypto-config/peerOrganizations/banka.example.com/peers/peer0.banka.example.com/msp:/etc/hyperledger/fabric/msp
    ports:
      - 7051:7051
    networks:
      - bankchain

  peer0.bankb.example.com:
    container_name: peer0.bankb.example.com
    image: hyperledger/fabric-peer:2.5
    environment:
      - CORE_PEER_ID=peer0.bankb.example.com
      - CORE_PEER_ADDRESS=peer0.bankb.example.com:8051
      - CORE_PEER_LISTENADDRESS=0.0.0.0:8051
      - CORE_PEER_CHAINCODEADDRESS=peer0.bankb.example.com:8052
      - CORE_PEER_LOCALMSPID=BankBMSP
    volumes:
      - ./crypto-config/peerOrganizations/bankb.example.com/peers/peer0.bankb.example.com/msp:/etc/hyperledger/fabric/msp
    ports:
      - 8051:8051
    networks:
      - bankchain

  cli:
    container_name: cli
    image: hyperledger/fabric-tools:2.5
    tty: true
    environment:
      - SYS_CHANNEL=bankchain
      - GOPATH=/opt/gopath
      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
      - CORE_LOGGING_LEVEL=DEBUG
      - CORE_PEER_ID=cli
      - CORE_PEER_ADDRESS=peer0.banka.example.com:7051
      - CORE_PEER_LOCALMSPID=BankAMSP
      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/banka.example.com/users/Admin@banka.example.com/msp
    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    command: /bin/bash
    volumes:
      - /var/run/:/host/var/run/
      - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/
      - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/
      - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts
    networks:
      - bankchain

sudo apt update
sudo apt install ca-certificates curl gnupg -y
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin -y
BÃ¢y giá» báº¡n cÃ³ thá»ƒ tiáº¿p tá»¥c cháº¡y lá»‡nh nÃ y Ä‘á»ƒ khá»Ÿi táº¡o máº¡ng Fabric:
docker compose -f docker-compose-bankchain.yaml up -d


ğŸ’¡ LÆ°u Ã½:

Náº¿u file cá»§a báº¡n tÃªn tháº­t lÃ  docker-compose-bankchain.yaml (khÃ´ng cÃ³ dáº¥u gáº¡ch giá»¯a bank vÃ  chain), hÃ£y kiá»ƒm tra báº±ng:

ls | grep docker-compose


rá»“i dÃ¹ng Ä‘Ãºng tÃªn file trong lá»‡nh.

Sau khi cháº¡y, kiá»ƒm tra cÃ¡c container cÃ³ cháº¡y chÆ°a:

docker ps


Báº¡n sáº½ tháº¥y cÃ¡c container nhÆ° orderer.example.com, peer0.banka.example.com, cli, couchdb, v.v.


âœ… BÆ°á»›c 1: Má»Ÿ file base

Báº¡n cháº¡y:

nano base/docker-compose-base-bankchain.yaml


(ÄÃ¢y má»›i lÃ  file chá»©a cÃ¡c image bá»‹ sai)

âœ… BÆ°á»›c 2: TÃ¬m táº¥t cáº£ dÃ²ng cÃ³ ${IMAGE_TAG}

Báº¡n tÃ¬m cÃ¡c dÃ²ng giá»‘ng:

image: hyperledger/fabric-peer:${IMAGE_TAG}
image: hyperledger/fabric-orderer:${IMAGE_TAG}
image: hyperledger/fabric-tools:${IMAGE_TAG}

âœ… BÆ°á»›c 3: Thay báº±ng phiÃªn báº£n chuáº©n (2.2)

Sá»­a thÃ nh:

image: hyperledger/fabric-peer:2.2
image: hyperledger/fabric-orderer:2.2
image: hyperledger/fabric-tools:2.2


LÆ°u láº¡i: Ctrl + O â†’ Enter â†’ Ctrl + X

âœ… BÆ°á»›c 4: XoÃ¡ toÃ n bá»™ container cÅ© Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t

Cháº¡y:

docker system prune -af

âœ… BÆ°á»›c 5: Cháº¡y láº¡i Docker Compose
docker compose -f docker-compose-bankchain.yaml up -d

âœ… BÆ°á»›c 6: Kiá»ƒm tra
docker ps

nano first-network/docker-compose-base.yaml

