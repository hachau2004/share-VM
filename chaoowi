∆Ø·ªöC 2 ‚Äî N·∫øu container ch∆∞a ch·∫°y ‚Üí kh·ªüi ƒë·ªông l·∫°i

Ch·∫°y:

docker run --rm -it \
    -p 8000:8000 \
    --name stellar-quickstart \
    stellar/quickstart:stable \
    --standalone


Ch·ªù ƒë·∫øn khi b·∫°n th·∫•y d√≤ng:

Horizon listening on port 8000

‚úÖ B∆Ø·ªöC 3 ‚Äî Ki·ªÉm tra l·∫°i port 8000
curl http://localhost:8000


N·∫øu OK b·∫°n s·∫Ω th·∫•y:

{
  "horizon_version": "...",
  "core_version": "...",
  "network_passphrase": "Test SDF Network ; September 2015",
  ...
}

node scripts/create_usdx_network.js

const StellarSDK = require("stellar-sdk");
const fetch = require("node-fetch");
require("dotenv").config();

const HORIZON = "http://localhost:8000";
const server = new StellarSDK.Server(HORIZON);
StellarSDK.Networks.useTestNetwork();

async function friendbot(pk) {
  console.log(`Funding ${pk} ...`);
  const res = await fetch(`${HORIZON}/friendbot?addr=${pk}`);
  const json = await res.json();
  return json;
}

async function createAccount() {
  const kp = StellarSDK.Keypair.random();
  await friendbot(kp.publicKey());
  return kp;
}

async function setTrustline(kp, asset) {
  const acc = await server.loadAccount(kp.publicKey());
  const tx = new StellarSDK.TransactionBuilder(acc, {
    fee: StellarSDK.BASE_FEE,
    networkPassphrase: StellarSDK.Networks.TESTNET
  })
    .addOperation(
      StellarSDK.Operation.changeTrust({
        asset: asset,
      })
    )
    .setTimeout(30)
    .build();

  tx.sign(kp);
  return server.submitTransaction(tx);
}

async function sendAsset(issuerKp, to, asset, amount) {
  const acc = await server.loadAccount(issuerKp.publicKey());
  const tx = new StellarSDK.TransactionBuilder(acc, {
    fee: StellarSDK.BASE_FEE,
    networkPassphrase: StellarSDK.Networks.TESTNET
  })
    .addOperation(
      StellarSDK.Operation.payment({
        destination: to,
        asset: asset,
        amount: amount.toString(),
      })
    )
    .setTimeout(30)
    .build();

  tx.sign(issuerKp);
  return server.submitTransaction(tx);
}

(async () => {
  // Create 3 accounts
  const issuer = await createAccount();
  const bankA = await createAccount();
  const bankB = await createAccount();

  console.log("Issuer:", issuer.publicKey());
  console.log("BankA :", bankA.publicKey());
  console.log("BankB :", bankB.publicKey());

  const USDX = new StellarSDK.Asset("USDX", issuer.publicKey());

  console.log("Setting trustlines...");
  await setTrustline(bankA, USDX);
  await setTrustline(bankB, USDX);

  console.log("Sending 10000 USDX to BankA...");
  await sendAsset(issuer, bankA.publicKey(), USDX, 10000);

  const fs = require("fs");
  fs.writeFileSync(
    "./usdx-keys.json",
    JSON.stringify(
      {
        ISSUER_PUBLIC: issuer.publicKey(),
        ISSUER_SECRET: issuer.secret(),
        BANKA_PUBLIC: bankA.publicKey(),
        BANKA_SECRET: bankA.secret(),
        BANKB_PUBLIC: bankB.publicKey(),
        BANKB_SECRET: bankB.secret(),
      },
      null,
      2
    )
  );

  console.log("DONE! Keys saved to usdx-keys.json");
})();

3Ô∏è‚É£ L∆∞u file

Trong nano:

üëâ Nh·∫•n CTRL + O ‚Üí Enter
üëâ Nh·∫•n CTRL + X ƒë·ªÉ tho√°t

4Ô∏è‚É£ Ch·∫°y script
cd ~/stellar-dev
node scripts/create_usdx_network.js

üéâ K·∫øt qu·∫£ b·∫°n s·∫Ω th·∫•y:

3 public keys

Trustlines created

10,000 USDX g·ª≠i v√†o BankA

File usdx-keys.json xu·∫•t hi·ªán trong ~/stellar-dev

N·∫øu g·∫∑p l·ªói ‚Äúfriendbot unreachable‚Äù

Ch·∫°y th√™m:

docker logs stellar-quickstart | grep "root"


L·∫•y ADMIN_SECRET ‚Üí export:

export ADMIN_SECRET="SECRET_FROM_LOGS"
B∆∞·ªõc 1 ‚Äî Kh·ªüi ƒë·ªông Stellar quickstart (Horizon + Core) b·∫±ng Docker

K√©o image & ch·∫°y:

docker pull docker.io/stellar/quickstart:latest
docker run -d --name stellar-quickstart -p 8000:8000 -p 11626:11626 docker.io/stellar/quickstart:latest


Ki·ªÉm tra:

docker ps --filter "name=stellar-quickstart" --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
docker logs stellar-quickstart --tail 200
curl http://localhost:8000/ledgers | jq '.'


‚Äî Mong th·∫•y JSON ledger tr·∫£ v·ªÅ (Horizon ho·∫°t ƒë·ªông).

M·∫πo: n·∫øu quickstart in ra Network root secret (MASTER SEED), l∆∞u l·∫°i n·∫øu friendbot kh√¥ng ho·∫°t ƒë·ªông.

B∆∞·ªõc 2 ‚Äî T·∫°o Issuer, BankA, BankB v√† issue asset USDX

File m·∫´u script: ~/stellar-dev/scripts/create_usdx_network.js (ƒë√£ c√≥ n·ªôi dung trong file). Th·ª±c hi·ªán:

T·∫°o th∆∞ m·ª•c & c√†i deps:

mkdir -p ~/stellar-dev/scripts
cd ~/stellar-dev
npm init -y
npm install stellar-sdk dotenv node-fetch@2


T·∫°o / ch·∫°y script (n·∫øu b·∫°n ƒë√£ c√≥ file trong repo, ch·ªâ ch·∫°y):

node scripts/create_usdx_network.js


Script s·∫Ω t·∫°o 3 keypairs, g·ªçi friendbot (http://localhost:8000/friendbot
) ƒë·ªÉ fund, set trustlines BankA/BankB, issuer g·ª≠i 10000 USDX ‚Üí BankA.

K·∫øt qu·∫£ ghi v√†o ~/stellar-dev/usdx-keys.json

N·∫øu mu·ªën chuy·ªÉn ngay:

node scripts/create_usdx_network.js transfer 500


Ki·ªÉm tra balances:

export ISSUER_PUBLIC=$(jq -r .ISSUER_PUBLIC ~/stellar-dev/usdx-keys.json)
export BANKA_PUBLIC=$(jq -r .BANKA_PUBLIC ~/stellar-dev/usdx-keys.json)
export BANKB_PUBLIC=$(jq -r .BANKB_PUBLIC ~/stellar-dev/usdx-keys.json)

curl -s "http://localhost:8000/accounts/${BANKA_PUBLIC}" | jq '.balances'
curl -s "http://localhost:8000/accounts/${BANKB_PUBLIC}" | jq '.balances'


M·∫πo x·ª≠ l√Ω l·ªói: n·∫øu friendbot kh√¥ng reachable, truy·ªÅn ADMIN_SECRET (root secret in logs quickstart) v√†o ENV tr∆∞·ªõc khi ch·∫°y script ƒë·ªÉ script d√πng admin t·∫°o account.

B∆∞·ªõc 3 ‚Äî C·∫•u h√¨nh stellar.toml (ph·ª•c v·ª• b·∫±ng static server)

T·∫°o file static:

mkdir -p ~/stellar-dev/static/.well-known
cat > ~/stellar-dev/static/.well-known/stellar.toml <<'TOML'
NETWORK_PASSPHRASE="Test SDF Network ; September 2015"
DOCUMENTATION="Local demo single-domain (Chapter 5 style)"
FEDERATION_SERVER="http://localhost:3001/federation"
TRANSFER_SERVER="http://localhost:3020/transfer"
AUTH_SERVER="http://localhost:3001/auth"
KYC_SERVER="http://localhost:3010/kyc"
ACCOUNTS=["$ISSUER_PUBLIC"]
TOML


D√πng express ƒë·ªÉ serve:

cd ~/stellar-dev/static
npm init -y
npm install express
node server.js & disown


Test:

curl -sS http://localhost:8080/.well-known/stellar.toml

B∆∞·ªõc 4 ‚Äî Federation (port 3001)

T·∫°o server federation (file ~/stellar-dev/federation/server.js) ‚Äî resolve name*localhost ‚Üí public key (m√£ s·∫µn trong usdx-keys.json).

C√†i & ch·∫°y:

cd ~/stellar-dev/federation
npm init -y
npm install express
node server.js & disown


Test resolve:

curl "http://localhost:3001/federation?q=banka*localhost&type=name"
curl -s "http://localhost:3001/federation?q=bankb*localhost" | jq .

B∆∞·ªõc 5 ‚Äî Compliance / KYC mock (port 3010)

T·∫°o server KYC (in-memory) ‚Äî ~/stellar-dev/compliance/server.js.

C√†i & ch·∫°y:

cd ~/stellar-dev/compliance
npm init -y
npm install express body-parser
node server.js & disown


Test:

curl -s -X POST http://localhost:3010/kyc -H 'content-type:application/json' -d '{"id":"cust1","name":"Nguyen Van A"}' | jq .
curl -s http://localhost:3010/kyc/cust1 | jq .


‚Äî Policy ƒë∆°n gi·∫£n: name ch·ª©a "bad" ‚áí reject.

B∆∞·ªõc 6 ‚Äî Bridge (port 3020) ‚Äî t·∫°o & submit Stellar tx

~/stellar-dev/bridge/server.js c√≥ code sign tx b·∫±ng BANKA_SECRET, optional KYC check, submit l√™n Horizon.

C√†i & ch·∫°y:

cd ~/stellar-dev/bridge
npm init -y
npm install express body-parser stellar-sdk node-fetch@2
node server.js & disown


Test transfer (sau khi KYC approved):

# ensure KYC record exists
curl -s -X POST http://localhost:3010/kyc -H 'content-type:application/json' -d '{"id":"cust1","name":"Nguyen Van A"}' | jq .
# call bridge
TO=$BANKB_PUBLIC
curl -s -X POST http://localhost:3020/transfer -H 'content-type:application/json' \
  -d "{\"to\":\"$TO\",\"amount\":\"5\",\"kycId\":\"cust1\",\"callbackUrl\":\"http://localhost:3030/webhook\"}" | jq .


‚Äî N·∫øu success: JSON { "status":"ok", "tx":"<hash>" }.

X√°c th·ª±c giao d·ªãch tr√™n Horizon:

curl -s "http://localhost:8000/transactions/<TX_HASH>/operations" | jq .

B∆∞·ªõc 7 ‚Äî Callbacks / Webhooks (port 3030)

~/stellar-dev/callbacks/server.js l∆∞u events v√†o memory v√† expose /events.

C√†i & ch·∫°y:

cd ~/stellar-dev/callbacks
npm init -y
npm install express body-parser
node server.js & disown


Test xem event c√≥ t·ªõi ch∆∞a:

curl -s http://localhost:3030/events | jq .

B∆∞·ªõc 8 ‚Äî Portal Backend (port 3040)

~/stellar-dev/portal-backend/server.js ‚Äî mock login, proxy federation, forward KYC & transfer t·ªõi services.

C√†i & ch·∫°y:

cd ~/stellar-dev/portal-backend
npm init -y
npm install express body-parser node-fetch@2
node server.js & disown


Test:

curl -s -X POST http://localhost:3040/api/login -H 'content-type:application/json' -d '{"username":"banka"}' | jq .
curl -s "http://localhost:3040/api/resolve?q=bankb*localhost" | jq .
curl -s "http://localhost:3040/api/balances?account=${BANKA_PUBLIC}" | jq .

B∆∞·ªõc 9 ‚Äî Frontend React (port 3000)

T·∫°o app (n·∫øu ch∆∞a c√≥):

cd ~/stellar-dev
npx create-react-app portal-frontend
cd portal-frontend
# th√™m "proxy": "http://localhost:3040" v√†o package.json (script ƒë√£ cung c·∫•p)
npm install


Thay src/App.js v√† src/App.css b·∫±ng n·ªôi dung trong file (m√¨nh ƒë√£ copy n·ªôi dung trong doc).

Ch·∫°y:

npm start


M·ªü tr√¨nh duy·ªát: http://localhost:3000 ‚Äî login b·∫±ng banka ho·∫∑c bankb (mock).

B∆∞·ªõc 10 ‚Äî Ch·∫°y demo end-to-end

Ki·ªÉm tra m·ªçi d·ªãch v·ª• ƒëang ch·∫°y (c√°c port m·∫∑c ƒë·ªãnh):

8080 static (stellar.toml)
3001 federation
3010 compliance (KYC)
3020 bridge
3030 callbacks
3040 portal-backend
3000 frontend
8000 Horizon


B·∫°n c√≥ th·ªÉ d√πng ss -lntu ho·∫∑c lsof -i -P -n | grep LISTEN ƒë·ªÉ ki·ªÉm tra.

Approve KYC:

curl -s -X POST http://localhost:3010/kyc -H 'content-type:application/json' -d '{"id":"cust1","name":"Nguyen Van A"}' | jq .


T·ª´ UI (frontend) ‚Äî login banka, resolve bankb*localhost, g·ª≠i amount (vd 10) v√† optional kycId:cust1. Ho·∫∑c d√πng API:

BANKB=$(jq -r .BANKB_PUBLIC ~/stellar-dev/usdx-keys.json)
curl -s -X POST http://localhost:3040/api/transfer -H 'content-type:application/json' \
  -d "{\"to\":\"$BANKB\",\"amount\":\"10\",\"kycId\":\"cust1\",\"callbackUrl\":\"http://localhost:3030/webhook\"}" | jq .


Ki·ªÉm tra callbacks/events:

curl -s http://localhost:3030/events | jq .


Ki·ªÉm tra balances tr√™n Horizon:

curl -s "http://localhost:8000/accounts/${BANKA_PUBLIC}" | jq '.balances'
curl -s "http://localhost:8000/accounts/${BANKB_PUBLIC}" | jq '.balances'

Ki·ªÉm tra & debugging ‚Äî checklist nhanh

Friendbot unreachable ‚Üí cung c·∫•p ADMIN_SECRET (t·ª´ docker logs quickstart) cho script create accounts.

N·∫øu server.submitTransaction l·ªói: xem l·ªói chi ti·∫øt (err.response.data) ‚Äî th∆∞·ªùng l·ªói trustline / asset not authorized / insufficient balance.

N·∫øu frontend kh√¥ng resolve bankb*localhost: ki·ªÉm tra federation ch·∫°y (port 3001) v√† proxy backend (3040) c√≥ truy c·∫≠p ƒë√∫ng.

N·∫øu callback kh√¥ng nh·∫≠n event: ki·ªÉm tra callbackUrl g·ª≠i t·ª´ bridge c√≥ ƒë√∫ng http://localhost:3030/webhook v√† callbacks service ƒëang ch·∫°y.

N·∫øu Horizon tr·∫£ transaction contains operations that would change trust etc: ki·ªÉm tra tx ƒë√£ k√Ω ƒë√∫ng key (BankA secret) v√† asset issuer ƒë√∫ng.

C√°c l·ªánh h·ªØu √≠ch t√≥m t·∫Øt

Xem docker logs quickstart (l·∫•y ADMIN_SECRET n·∫øu in ra):

docker logs stellar-quickstart --tail 200


Xem accounts / balances:

curl -s "http://localhost:8000/accounts/<PUBLIC_KEY>" | jq '.balances'


Xem payments cho account:

curl -s "http://localhost:8000/accounts/<PUBLIC_KEY>/payments?order=desc&limit=10" | jq .


Xem events webhook:

curl -s http://localhost:3030/events | jq .

Nh·ªØng c·∫£i ti·∫øn & extension b·∫°n c√≥ th·ªÉ th·ª≠ (sau khi b·∫£n demo ch·∫°y ·ªïn)

L∆∞u KYC v√†o DB (Postgres) thay v√¨ in-memory.

Th√™m Horizon streaming (horizon payments stream) v√†o callbacks ƒë·ªÉ c·∫≠p nh·∫≠t realtime thay v√¨ callback t·ª´ bridge.

Th√™m audit log v√† webhook retry.

M√¥ ph·ªèng AML rule ph·ª©c t·∫°p (v√≠ d·ª•: limit threshold, country checks, sanctions list).

N·∫øu b·∫°n mu·ªën, m√¨nh c√≥ th·ªÉ:

Sinh checklist bash script ƒë·ªÉ kh·ªüi t·∫•t c·∫£ services (systemd / pm2 / docker compose style).

Vi·∫øt file docker-compose.yml ƒë·ªÉ kh·ªüi Horizon + services (y√™u c·∫ßu m√¨nh t·∫°o n·ªôi dung compose).

Ho·∫∑c gi√∫p b·∫°n debug l·ªói c·ª• th·ªÉ ‚Äî d√°n l·ªói log ·ªü ƒë√¢y, m√¨nh ch·ªâ ra nguy√™n nh√¢n v√† c√°ch s·ª≠a.

B·∫°n mu·ªën m√¨nh l√†m ti·∫øp theo ph∆∞∆°ng √°n n√†o?
