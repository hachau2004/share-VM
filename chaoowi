✅ Cách xử lý để giải phóng Docker & không bị treo nữa
✅ Bước 1: Dừng toàn bộ Docker ngay lập tức

Chạy:

sudo systemctl stop docker


Chờ 5–10 giây cho CPU hạ.

✅ Bước 2: Xóa cache image CouchDB bị lỗi
sudo rm -rf /var/lib/docker


⚠️ CẢNH BÁO: điều này xóa toàn bộ images/containers/network → sạch 100%
(Đây là cách duy nhất nếu Docker bị freeze do image manifest lỗi)

Nếu bạn không muốn full reset, dùng lệnh nhẹ hơn:

sudo rm -rf /var/lib/docker/image

✅ Bước 3: Khởi động lại Docker
sudo systemctl start docker


Kiểm tra:

docker ps

✅ Bước 4: Mở lại file docker-compose và đảm bảo KHÔNG CÓ bất kỳ dòng nào dùng couchdb:3.x

Bạn phải đổi toàn bộ thành:

image: couchdb:3.1.2


Kiểm tra lại bằng:

grep -R "couchdb" docker-compose-bankchain.yaml


Output phải là:

✅ couchdb:3.1.2
❌ Tuyệt đối không được có 3.2 hay 3.3

✅ Bước 5: Test tải image CouchDB ARM64 trước khi chạy compose

Chạy:

docker pull couchdb:3.1.2


Nếu pull OK → ARM64 supported → an toàn.

Nếu pull bị đứng → vẫn còn bản cũ → bạn chưa delete hết cache Docker.

✅ Bước 6: Bật compose lại
docker compose -f docker-compose-bankchain.yaml up -d

✅ Nếu vẫn còn đứng, gửi tôi 2 thứ:
✅ 1. Kết quả lệnh:
docker version


(để biết engine ARM64 hay x86_64)

✅ 2. Kết quả lệnh:
uname -m


(để xác nhận kiến trúc CPU)
