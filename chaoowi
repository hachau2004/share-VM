✅ BƯỚC 1 — DỪNG TOÀN BỘ MẠNG HOÀN TOÀN

Chạy:

docker rm -f $(docker ps -aq)
docker volume prune -f
docker network prune -f


→ Điều này rất quan trọng vì trước đó mạng bị lỗi DNS + CouchDB 3.3 crash làm peer không start được.

✅ BƯỚC 2 — KHỞI ĐỘNG LẠI
docker compose -f docker-compose-bankchain.yaml up -d


Sau đó kiểm tra:

docker ps


Kết quả đúng phải thấy:

✅ couchdb0, couchdb1, couchdb2, couchdb3
✅ peer0.banka, peer1.banka
✅ peer0.bankb, peer1.bankb
✅ orderer.example.com
✅ cli

Nếu peer0.banka.example.com đang RUNNING → OK
Nếu Exit 1 → vẫn lỗi.

✅ BƯỚC 3 — KIỂM TRA LOG CỦA PEER 0 BANK A
docker logs peer0.banka.example.com --tail=100


Bạn phải thấy:

✅ "Listening on 0.0.0.0:7051"
✅ "Starting peer with MSP bankaMSP"
✅ KHÔNG còn lỗi "unable to connect to CouchDB"

✅ BƯỚC 4 — VÀO CLI
docker exec -it cli bash


Trong CLI:

export CORE_PEER_LOCALMSPID="bankaMSP"
export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/banka.example.com/users/Admin@banka.example.com/msp
export CORE_PEER_ADDRESS=peer0.banka.example.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/banka.example.com/peers/peer0.banka.example.com/tls/ca.crt
export CHANNEL_NAME=bankchannel


Test DNS:

getent hosts peer0.banka.example.com


Bạn phải thấy:

172.18.0.x peer0.banka.example.com


Nếu ra dòng trống → peer chưa chạy hoặc mạng lỗi.

✅ BƯỚC 5 — JOIN CHANNEL (Lần này sẽ chạy được)
peer channel join -b ./channel-artifacts/bankchannel.block


Kết quả đúng:

Successfully submitted proposal to join channel

✅ BƯỚC 6 — CẤU HÌNH PEER1 BANK A
export CORE_PEER_ADDRESS=peer1.banka.example.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/banka.example.com/peers/peer1.banka.example.com/tls/ca.crt
peer channel join -b ./channel-artifacts/bankchannel.block

✅ BƯỚC 7 — CẤU HÌNH BANK B
export CORE_PEER_LOCALMSPID="bankbMSP"
export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/bankb.example.com/users/Admin@bankb.example.com/msp
export CORE_PEER_ADDRESS=peer0.bankb.example.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/bankb.example.com/peers/peer0.bankb.example.com/tls/ca.crt

peer channel join -b ./channel-artifacts/bankchannel.block


Làm tương tự cho peer1.bankb.

✅ BƯỚC 8 — KIỂM TRA CHANNEL

Sau khi join xong tất cả:

peer channel list


Bạn phải thấy:

bankchannel
