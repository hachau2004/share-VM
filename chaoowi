PH·∫¶N A ‚Äî C√ÄI ƒê·∫∂T M√îI TR∆Ø·ªúNG
1. C√†i Node.js

Ki·ªÉm tra:

node -v
npm -v

2. C√†i Truffle
npm install -g truffle


Ki·ªÉm tra:

truffle version

3. C√†i Ganache GUI

M·ªü Ganache ‚Üí Quickstart

RPC server: HTTP://127.0.0.1:7545

C√≥ 10 account, m·ªói c√°i 100 ETH

4. C√†i MetaMask

C√†i extension t·ª´ metamask.io

T·∫°o v√≠ m·ªõi.

PH·∫¶N B ‚Äî T·∫†O PROJECT
1. Clone source c·ªßa s√°ch
git clone https://github.com/PacktPublishing/Blockchain-Development-for-Finance-Projects.git


üìÇ V√†o th∆∞ m·ª•c:

...\Blockchain-Development-for-Finance-Projects\Chapter 6

2. C√†i OpenZeppelin

Trong th∆∞ m·ª•c Chapter 6:

npm install @openzeppelin/contracts

3. T·∫°o skeleton Truffle (r·∫•t quan tr·ªçng)

Trong th∆∞ m·ª•c Chapter 6, ch·∫°y:

truffle init


‚ö†Ô∏è N·∫øu h·ªèi overwrite .sol ‚Üí ch·ªçn NO / SKIP
V√¨ b·∫°n ƒë√£ c√≥ LC.sol, USD.sol, LCMaster.sol.

4. S·ª≠a file truffle-config.js

Thay to√†n b·ªô n·ªôi dung b·∫±ng:

module.exports = {
  networks: {
    development: {
      host: "127.0.0.1",
      port: 7545,
      network_id: "*",
    }
  },

  compilers: {
    solc: {
      version: "0.5.16",
      settings: {
        optimizer: {
          enabled: true,
          runs: 200
        }
      }
    }
  }
};

5. Ki·ªÉm tra th∆∞ m·ª•c contracts/

Ph·∫£i c√≥:

LC.sol
LCMaster.sol
USD.sol
Migrations.sol


N·∫øu thi·∫øu Migrations.sol, t·∫°o file v·ªõi n·ªôi dung y nh∆∞ b√†i g·ªëc:

pragma solidity ^0.5.16;

contract Migrations {
  address public owner;
  uint public last_completed_migration;

  constructor() public {
    owner = msg.sender;
  }

  modifier restricted() {
    require(msg.sender == owner, "This function is restricted to the contract's owner");
    _;
  }

  function setCompleted(uint completed) public restricted {
    last_completed_migration = completed;
  }
}

6. T·∫°o file migration
6.1. File 1_initial_migration.js

ƒê√∫ng n·ªôi dung:

const Migrations = artifacts.require("Migrations");

module.exports = function (deployer) {
  deployer.deploy(Migrations);
};

6.2. File 2_deploy_contracts.js

T·∫°o file:

Chapter 6/migrations/2_deploy_contracts.js


N·ªôi dung y nh∆∞ b√†i g·ªëc:

const USD = artifacts.require("USD");
const LCMaster = artifacts.require("LCMaster");

module.exports = async function (deployer, network, accounts) {

  await deployer.deploy(USD);
  const usd = await USD.deployed();

  await deployer.deploy(LCMaster, usd.address);
  const master = await LCMaster.deployed();

  console.log("USD token deployed at:", usd.address);
  console.log("LCMaster deployed at:", master.address);
};

PH·∫¶N C ‚Äî COMPILE & MIGRATE
1. B·∫≠t Ganache GUI (port 7545)
2. Compile

T·∫°i th∆∞ m·ª•c Chapter 6:

truffle compile


N·∫øu ƒë√∫ng b·∫°n s·∫Ω th·∫•y compile th√†nh c√¥ng.

3. Deploy (migrate)
truffle migrate --reset --network development


K·∫øt qu·∫£ s·∫Ω in ra:

USD deployed at: ‚Ä¶

LCMaster deployed at: ‚Ä¶

‚úçÔ∏è Ghi l·∫°i 2 ƒë·ªãa ch·ªâ n√†y.

PH·∫¶N D ‚Äî K·∫æT N·ªêI REACT DAPP (LCApp)
1. Copy ABI sang React

T·ª´ th∆∞ m·ª•c:

Chapter 6/build/contracts


Copy 3 file:

LC.json
LCMaster.json
USD.json


D√°n v√†o:

Chapter 6/LCApp/src/Contracts/

2. Ch·ªânh ƒë·ªãa ch·ªâ contract trong LCApp

Trong file:

LCApp/src/App.js


S·ª≠a ƒë·ªãa ch·ªâ:

const USDAddress = "ƒë·ªãa_ch·ªâ_USD";
const LCMasterAddress = "ƒë·ªãa_ch·ªâ_LCMaster";

3. Ch·∫°y ·ª©ng d·ª•ng React
cd LCApp
npm install
npm start


Web m·ªü ·ªü:

http://localhost:3000

PH·∫¶N E ‚Äî THAO T√ÅC TR√äN DAPP (y h·ªát b√†i g·ªëc)
1. Bank t·∫°o LC

MetaMask ‚Üí ch·ªçn account Bank

Nh·∫≠p:

Buyer address

Seller address

Amount

Expiry date

Nh·∫•n Create LC

2. Buyer / Seller xem LC

ƒê·ªïi account trong MetaMask
‚Üí v√†o View LC

3. Seller t·∫°o DocHash

T·∫°o file invoice ‚Üí t√≠nh SHA-256 hash ‚Üí copy hash

4. Seller y√™u c·∫ßu thanh to√°n (settle)

Trong tab Seller:

ch·ªçn LC

nh·∫≠p amount (v√≠ d·ª• 500)

nh·∫≠p DocHash

Submit

Tr·∫°ng th√°i chuy·ªÉn:

t·ª´ I ‚Üí P n·∫øu tr·∫£ 1 ph·∫ßn

t·ª´ P ‚Üí S n·∫øu tr·∫£ h·∫øt
