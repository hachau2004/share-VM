node -e "require('dotenv').config(); console.log(process.env.ISSUER_PUBLIC)"
BƯỚC 6 — Viết API cho hệ thống USDX (Issuer / BankA / BankB)

Bạn sẽ tạo 1 thư mục:

mkdir api


Trong đó có 3 server để mô phỏng giao dịch trong mạng ngân hàng.

✔ File 1: api/issuer.js

Issuer sẽ chỉ có nhiệm vụ:

kiểm tra số dư

cấp thêm USDX

Dán vào file:

const express = require("express");
const StellarSDK = require("stellar-sdk");
require("dotenv").config();

const app = express();
app.use(express.json());

const server = new StellarSDK.Server(process.env.HORIZON, { allowHttp: true });

const issuerKp = StellarSDK.Keypair.fromSecret(process.env.ISSUER_SECRET);

const USDX = new StellarSDK.Asset("USDX", issuerKp.publicKey());

// Check balance
app.get("/balance", async (req, res) => {
  const acc = await server.loadAccount(issuerKp.publicKey());
  const bal = acc.balances;
  res.json(bal);
});

// Issue new USDX → send to someone
app.post("/issue", async (req, res) => {
  const { to, amount } = req.body;

  try {
    const acc = await server.loadAccount(issuerKp.publicKey());

    const tx = new StellarSDK.TransactionBuilder(acc, {
      fee: StellarSDK.BASE_FEE,
      networkPassphrase: process.env.NETWORK_PASSPHRASE,
    })
      .addOperation(
        StellarSDK.Operation.payment({
          destination: to,
          asset: USDX,
          amount: amount.toString(),
        })
      )
      .setTimeout(30)
      .build();

    tx.sign(issuerKp);

    const result = await server.submitTransaction(tx);
    res.json(result);
  } catch (e) {
    res.json({ error: e.toString() });
  }
});

app.listen(3001, () => console.log("Issuer API running on 3001"));


Chạy:

node api/issuer.js

✅ BƯỚC 7 — Tạo API cho BankA (Distributor)
✔ File 2: api/bankA.js

Dán vào:

const express = require("express");
const StellarSDK = require("stellar-sdk");
require("dotenv").config();

const app = express();
app.use(express.json());

const server = new StellarSDK.Server(process.env.HORIZON, { allowHttp: true });

const kp = StellarSDK.Keypair.fromSecret(process.env.BANKA_SECRET);
const USDX = new StellarSDK.Asset("USDX", process.env.ISSUER_PUBLIC);

// Check balance
app.get("/balance", async (req, res) => {
  const acc = await server.loadAccount(kp.publicKey());
  res.json(acc.balances);
});

// Transfer USDX to someone (like BankB)
app.post("/transfer", async (req, res) => {
  const { to, amount } = req.body;

  try {
    const acc = await server.loadAccount(kp.publicKey());
    const tx = new StellarSDK.TransactionBuilder(acc, {
      fee: StellarSDK.BASE_FEE,
      networkPassphrase: process.env.NETWORK_PASSPHRASE,
    })
      .addOperation(
        StellarSDK.Operation.payment({
          destination: to,
          asset: USDX,
          amount: amount.toString(),
        })
      )
      .setTimeout(30)
      .build();

    tx.sign(kp);
    res.json(await server.submitTransaction(tx));
  } catch (e) {
    res.json({ error: e.toString() });
  }
});

app.listen(3002, () => console.log("BankA API running on 3002"));


Chạy:

node api/bankA.js

✅ BƯỚC 8 — API cho BankB (Recipient)
✔ File 3: api/bankB.js
const express = require("express");
const StellarSDK = require("stellar-sdk");
require("dotenv").config();

const app = express();
app.use(express.json());

const server = new StellarSDK.Server(process.env.HORIZON, { allowHttp: true });

const kp = StellarSDK.Keypair.fromSecret(process.env.BANKB_SECRET);

// Check balance
app.get("/balance", async (req, res) => {
  const acc = await server.loadAccount(kp.publicKey());
  res.json(acc.balances);
});

app.listen(3003, () => console.log("BankB API running on 3003"));


Chạy:

node api/bankB.js
