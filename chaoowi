‚úÖ C√°ch ch·∫°y ƒë√∫ng
1. ƒêi v√†o ƒë√∫ng th∆∞ m·ª•c project

Ch·∫°y:

cd ~/stellar-dev


Ki·ªÉm tra xem c√≥ file:

ls scripts


K·∫øt qu·∫£ ph·∫£i c√≥:

create_usdx_network.js

2. Ch·∫°y script
node scripts/create_usdx_network.js

üéØ N·∫øu b·∫°n ch·∫°y l·ªánh n√†y ·ªü ~ (home) ‚Üí 100% l·ªói

V√¨ Node s·∫Ω t√¨m path:

/home/hachau/scripts/create_usdx_network.js


M√† kh√¥ng t·ªìn t·∫°i.

üî• T√ìM G·ªåN

B·∫°n ph·∫£i:

cd ~/stellar-dev
node scripts/create_usdx_network.js


N·∫øu b·∫°n g·ª≠i m√¨nh k·∫øt qu·∫£ c·ªßa:

ls ~/stellar-dev/scripts

üéØ B∆∞·ªõc 3: KI·ªÇM TRA Horizon ƒëang ch·∫°y

M·ªü terminal kh√°c, ch·∫°y:

curl http://localhost:8000


N·∫øu th·∫•y JSON tr·∫£ v·ªÅ ‚Üí OK.

üéØ B∆∞·ªõc 4: CH·∫†Y L·∫†I SCRIPT

Terminal m·ªõi (ƒëang ·ªü ~/stellar-dev):

node scripts/create_usdx_network.js

üîç N·∫øu b·∫°n mu·ªën ki·ªÉm tra Friendbot:
curl "http://localhost:8000/friendbot?addr=GB.
2. D√°n n·ªôi dung th·∫ø n√†y (KH√îNG c√≥ d·∫•u < >)

V√≠ d·ª•:

ISSUER_PUBLIC=GCOF6VJJXG...
ISSUER_SECRET=SCBX7JH...
BANKA_PUBLIC=GBLRAZEN...
BANKA_SECRET=SDF2BJK...
BANKB_PUBLIC=GAXP0TT...
BANKB_SECRET=SCJ8G84...

HORIZON=http://localhost:8000
NETWORK_PASSPHRASE="Standalone Network ; February 2017"


‚ö† L∆∞u √Ω quan tr·ªçng:

Kh√¥ng d√πng d·∫•u <copy>

Kh√¥ng d√πng d·∫•u <>

Kh√¥ng enter d√≤ng l·ªánh trong terminal

Ch·ªâ paste v√†o file nano

3. L∆∞u file

Nh·∫•n:

CTRL + O   ‚Üí Enter
CTRL + X   ‚Üí tho√°t

‚õî V√¨ sao b·∫°n b·ªã l·ªói?

B·∫°n ƒëang nh·∫≠p nh∆∞ sau:

ISSUER_PUBLIC=<copy t·ª´ usdx-keys.json>


Terminal hi·ªÉu <copy l√† input redirection ‚Üí g√¢y l·ªói syntax error near unexpected token newline.

üîß N·∫øu b·∫°n mu·ªën m√¨nh t·∫°o file .env ƒë√∫ng ho√†n ch·ªânh

H√£y g·ª≠i m√¨nh file usdx-keys.json, m√¨nh s·∫Ω vi·∫øt l·∫°i .env chu·∫©n cho b·∫°n.

N·∫øu xong r·ªìi, b·∫°n ch·∫°y ti·∫øp b∆∞·ªõc sau:

node scripts/send_usdx_bankA_to_bankB.js
B∆∞·ªõc 3 ‚Äî C·∫•u h√¨nh stellar.toml (ph·ª•c v·ª• b·∫±ng static server)

T·∫°o file static:

mkdir -p ~/stellar-dev/static/.well-known
cat > ~/stellar-dev/static/.well-known/stellar.toml <<'TOML'
NETWORK_PASSPHRASE="Test SDF Network ; September 2015"
DOCUMENTATION="Local demo single-domain (Chapter 5 style)"
FEDERATION_SERVER="http://localhost:3001/federation"
TRANSFER_SERVER="http://localhost:3020/transfer"
AUTH_SERVER="http://localhost:3001/auth"
KYC_SERVER="http://localhost:3010/kyc"
ACCOUNTS=["$ISSUER_PUBLIC"]
TOML


D√πng express ƒë·ªÉ serve:

cd ~/stellar-dev/static
npm init -y
npm install express
node server.js & disown


Test:

curl -sS http://localhost:8080/.well-known/stellar.toml

B∆∞·ªõc 4 ‚Äî Federation (port 3001)

T·∫°o server federation (file ~/stellar-dev/federation/server.js) ‚Äî resolve name*localhost ‚Üí public key (m√£ s·∫µn trong usdx-keys.json).

C√†i & ch·∫°y:

cd ~/stellar-dev/federation
npm init -y
npm install express
node server.js & disown


Test resolve:

curl "http://localhost:3001/federation?q=banka*localhost&type=name"
curl -s "http://localhost:3001/federation?q=bankb*localhost" | jq .

B∆∞·ªõc 5 ‚Äî Compliance / KYC mock (port 3010)

T·∫°o server KYC (in-memory) ‚Äî ~/stellar-dev/compliance/server.js.

C√†i & ch·∫°y:

cd ~/stellar-dev/compliance
npm init -y
npm install express body-parser
node server.js & disown


Test:

curl -s -X POST http://localhost:3010/kyc -H 'content-type:application/json' -d '{"id":"cust1","name":"Nguyen Van A"}' | jq .
curl -s http://localhost:3010/kyc/cust1 | jq .


‚Äî Policy ƒë∆°n gi·∫£n: name ch·ª©a "bad" ‚áí reject.

B∆∞·ªõc 6 ‚Äî Bridge (port 3020) ‚Äî t·∫°o & submit Stellar tx

~/stellar-dev/bridge/server.js c√≥ code sign tx b·∫±ng BANKA_SECRET, optional KYC check, submit l√™n Horizon.

C√†i & ch·∫°y:

cd ~/stellar-dev/bridge
npm init -y
npm install express body-parser stellar-sdk node-fetch@2
node server.js & disown


Test transfer (sau khi KYC approved):

# ensure KYC record exists
curl -s -X POST http://localhost:3010/kyc -H 'content-type:application/json' -d '{"id":"cust1","name":"Nguyen Van A"}' | jq .
# call bridge
TO=$BANKB_PUBLIC
curl -s -X POST http://localhost:3020/transfer -H 'content-type:application/json' \
  -d "{\"to\":\"$TO\",\"amount\":\"5\",\"kycId\":\"cust1\",\"callbackUrl\":\"http://localhost:3030/webhook\"}" | jq .


‚Äî N·∫øu success: JSON { "status":"ok", "tx":"<hash>" }.

X√°c th·ª±c giao d·ªãch tr√™n Horizon:

curl -s "http://localhost:8000/transactions/<TX_HASH>/operations" | jq .

B∆∞·ªõc 7 ‚Äî Callbacks / Webhooks (port 3030)

~/stellar-dev/callbacks/server.js l∆∞u events v√†o memory v√† expose /events.

C√†i & ch·∫°y:

cd ~/stellar-dev/callbacks
npm init -y
npm install express body-parser
node server.js & disown


Test xem event c√≥ t·ªõi ch∆∞a:

curl -s http://localhost:3030/events | jq .

B∆∞·ªõc 8 ‚Äî Portal Backend (port 3040)

~/stellar-dev/portal-backend/server.js ‚Äî mock login, proxy federation, forward KYC & transfer t·ªõi services.

C√†i & ch·∫°y:

cd ~/stellar-dev/portal-backend
npm init -y
npm install express body-parser node-fetch@2
node server.js & disown


Test:

curl -s -X POST http://localhost:3040/api/login -H 'content-type:application/json' -d '{"username":"banka"}' | jq .
curl -s "http://localhost:3040/api/resolve?q=bankb*localhost" | jq .
curl -s "http://localhost:3040/api/balances?account=${BANKA_PUBLIC}" | jq .

B∆∞·ªõc 9 ‚Äî Frontend React (port 3000)

T·∫°o app (n·∫øu ch∆∞a c√≥):

cd ~/stellar-dev
npx create-react-app portal-frontend
cd portal-frontend
# th√™m "proxy": "http://localhost:3040" v√†o package.json (script ƒë√£ cung c·∫•p)
npm install


Thay src/App.js v√† src/App.css b·∫±ng n·ªôi dung trong file (m√¨nh ƒë√£ copy n·ªôi dung trong doc).

Ch·∫°y:

npm start


M·ªü tr√¨nh duy·ªát: http://localhost:3000 ‚Äî login b·∫±ng banka ho·∫∑c bankb (mock).

B∆∞·ªõc 10 ‚Äî Ch·∫°y demo end-to-end

Ki·ªÉm tra m·ªçi d·ªãch v·ª• ƒëang ch·∫°y (c√°c port m·∫∑c ƒë·ªãnh):

8080 static (stellar.toml)
3001 federation
3010 compliance (KYC)
3020 bridge
3030 callbacks
3040 portal-backend
3000 frontend
8000 Horizon


B·∫°n c√≥ th·ªÉ d√πng ss -lntu ho·∫∑c lsof -i -P -n | grep LISTEN ƒë·ªÉ ki·ªÉm tra.

Approve KYC:

curl -s -X POST http://localhost:3010/kyc -H 'content-type:application/json' -d '{"id":"cust1","name":"Nguyen Van A"}' | jq .


T·ª´ UI (frontend) ‚Äî login banka, resolve bankb*localhost, g·ª≠i amount (vd 10) v√† optional kycId:cust1. Ho·∫∑c d√πng API:

BANKB=$(jq -r .BANKB_PUBLIC ~/stellar-dev/usdx-keys.json)
curl -s -X POST http://localhost:3040/api/transfer -H 'content-type:application/json' \
  -d "{\"to\":\"$BANKB\",\"amount\":\"10\",\"kycId\":\"cust1\",\"callbackUrl\":\"http://localhost:3030/webhook\"}" | jq .


Ki·ªÉm tra callbacks/events:

curl -s http://localhost:3030/events | jq .


Ki·ªÉm tra balances tr√™n Horizon:

curl -s "http://localhost:8000/accounts/${BANKA_PUBLIC}" | jq '.balances'
curl -s "http://localhost:8000/accounts/${BANKB_PUBLIC}" | jq '.balances'

Ki·ªÉm tra & debugging ‚Äî checklist nhanh

Friendbot unreachable ‚Üí cung c·∫•p ADMIN_SECRET (t·ª´ docker logs quickstart) cho script create accounts.

N·∫øu server.submitTransaction l·ªói: xem l·ªói chi ti·∫øt (err.response.data) ‚Äî th∆∞·ªùng l·ªói trustline / asset not authorized / insufficient balance.

N·∫øu frontend kh√¥ng resolve bankb*localhost: ki·ªÉm tra federation ch·∫°y (port 3001) v√† proxy backend (3040) c√≥ truy c·∫≠p ƒë√∫ng.

N·∫øu callback kh√¥ng nh·∫≠n event: ki·ªÉm tra callbackUrl g·ª≠i t·ª´ bridge c√≥ ƒë√∫ng http://localhost:3030/webhook v√† callbacks service ƒëang ch·∫°y.

N·∫øu Horizon tr·∫£ transaction contains operations that would change trust etc: ki·ªÉm tra tx ƒë√£ k√Ω ƒë√∫ng key (BankA secret) v√† asset issuer ƒë√∫ng.

C√°c l·ªánh h·ªØu √≠ch t√≥m t·∫Øt

Xem docker logs quickstart (l·∫•y ADMIN_SECRET n·∫øu in ra):

docker logs stellar-quickstart --tail 200


Xem accounts / balances:

curl -s "http://localhost:8000/accounts/<PUBLIC_KEY>" | jq '.balances'


Xem payments cho account:

curl -s "http://localhost:8000/accounts/<PUBLIC_KEY>/payments?order=desc&limit=10" | jq .


Xem events webhook:

curl -s http://localhost:3030/events | jq .

Nh·ªØng c·∫£i ti·∫øn & extension b·∫°n c√≥ th·ªÉ th·ª≠ (sau khi b·∫£n demo ch·∫°y ·ªïn)

L∆∞u KYC v√†o DB (Postgres) thay v√¨ in-memory.

Th√™m Horizon streaming (horizon payments stream) v√†o callbacks ƒë·ªÉ c·∫≠p nh·∫≠t realtime thay v√¨ callback t·ª´ bridge.

Th√™m audit log v√† webhook retry.

M√¥ ph·ªèng AML rule ph·ª©c t·∫°p (v√≠ d·ª•: limit threshold, country checks, sanctions list).

N·∫øu b·∫°n mu·ªën, m√¨nh c√≥ th·ªÉ:

Sinh checklist bash script ƒë·ªÉ kh·ªüi t·∫•t c·∫£ services (systemd / pm2 / docker compose style).

Vi·∫øt file docker-compose.yml ƒë·ªÉ kh·ªüi Horizon + services (y√™u c·∫ßu m√¨nh t·∫°o n·ªôi dung compose).

Ho·∫∑c gi√∫p b·∫°n debug l·ªói c·ª• th·ªÉ ‚Äî d√°n l·ªói log ·ªü ƒë√¢y, m√¨nh ch·ªâ ra nguy√™n nh√¢n v√† c√°ch s·ª≠a.

B·∫°n mu·ªën m√¨nh l√†m ti·∫øp theo ph∆∞∆°ng √°n n√†o?
