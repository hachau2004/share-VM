B∆Ø·ªöC 6 ‚Äî Chuy·ªÉn USDX t·ª´ BankA ‚Üí BankB
6.1 ‚Äî T·∫°o file transfer_banka_to_bankb.js

Ch·∫°y:

cd ~/stellar-dev/scripts
nano transfer_banka_to_bankb.js


‚û° B√¢y gi·ªù d√°n NGUY√äN TO√ÄN B·ªò ƒëo·∫°n code n√†y v√†o (ƒë√¢y l√† b·∫£n ƒë√£ ki·ªÉm tra & chu·∫©n):

const S = require('stellar-sdk');
const fetch = global.fetch || require('node-fetch');

const HORIZON = process.env.HORIZON || 'http://localhost:8000';

// compatibility: find Server/Horizon constructor
let ServerClass = S.Server || (S.Horizon && S.Horizon.Server) || S.Horizon;
if (!ServerClass) {
  console.error('Cannot find Server/Horizon constructor in stellar-sdk exports. Installed version:', Object.keys(S).join(','));
  process.exit(2);
}

// Try to instantiate with allowHttp if supported, otherwise fallback
let server;
try {
  server = new ServerClass(HORIZON, { allowHttp: true });
} catch (err) {
  try {
    server = new ServerClass(HORIZON);
  } catch (e) {
    console.error('Failed to construct Horizon server client:', err.message || err);
    process.exit(3);
  }
}

(async () => {
  try {
    const FROM_SECRET = process.env.BANKA_SECRET;
    const TO_PUBLIC = process.env.BANKB_PUBLIC || process.argv[2];
    const ISSUER_PUBLIC = process.env.ISSUER_PUBLIC;
    const AMOUNT = process.argv[2] && process.argv[2].match(/^\d/) ? process.argv[2] : (process.argv[3] || '100');

    if (!FROM_SECRET) { console.error('Set BANKA_SECRET env'); process.exit(1); }
    if (!TO_PUBLIC) { console.error('Set BANKB_PUBLIC env or pass as first arg'); process.exit(1); }
    if (!ISSUER_PUBLIC) { console.error('Set ISSUER_PUBLIC env'); process.exit(1); }

    const fromKP = S.Keypair.fromSecret(FROM_SECRET);
    const acct = await server.loadAccount(fromKP.publicKey());
    const asset = new S.Asset('USDX', ISSUER_PUBLIC);
    const baseFee = await server.fetchBaseFee();

    const tx = new S.TransactionBuilder(acct, { fee: String(baseFee), networkPassphrase: S.Networks.TESTNET })
      .addOperation(S.Operation.payment({ destination: TO_PUBLIC, asset, amount: String(AMOUNT) }))
      .setTimeout(30)
      .build();

    tx.sign(fromKP);
    const res = await server.submitTransaction(tx);
    console.log('Payment submitted, tx hash:', res.hash);
    process.exit(0);
  } catch (e) {
    if (e.response && e.response.data) {
      console.error('Horizon error:', JSON.stringify(e.response.data, null, 2));
    } else {
      console.error('Error:', e.message || e);
    }
    process.exit(1);
  }
})();


L∆∞u file:

Ctrl + O ‚Üí Enter

Ctrl + X

‚úÖ 6.2 ‚Äî Set ENV ƒë·ªÉ script d√πng ƒë√∫ng key

Ch·∫°y:

export ISSUER_PUBLIC="$(jq -r .ISSUER_PUBLIC ~/stellar-dev/usdx-keys.json)"
export ISSUER_SECRET="$(jq -r .ISSUER_SECRET ~/stellar-dev/usdx-keys.json)"
export BANKA_PUBLIC="$(jq -r .BANKA_PUBLIC ~/stellar-dev/usdx-keys.json)"
export BANKA_SECRET="$(jq -r .BANKA_SECRET ~/stellar-dev/usdx-keys.json)"
export BANKB_PUBLIC="$(jq -r .BANKB_PUBLIC ~/stellar-dev/usdx-keys.json)"
export BANKB_SECRET="$(jq -r .BANKB_SECRET ~/stellar-dev/usdx-keys.json)"
export HORIZON="http://localhost:8000"


Ki·ªÉm tra:

echo $BANKA_SECRET
echo $BANKB_PUBLIC
echo $ISSUER_PUBLIC

‚úÖ 6.3 ‚Äî Ch·∫°y chuy·ªÉn 500 USDX t·ª´ BankA ‚Üí BankB

Ch·∫°y:

node ~/stellar-dev/scripts/transfer_banka_to_bankb.js 500


K·∫øt qu·∫£ ƒë√∫ng s·∫Ω l√†:

Payment submitted, tx hash: XXXXXXXXXXXXXXXXXXXXX


=> L·ªánh ƒë√£ CHUY·ªÇN 500 USDX th√†nh c√¥ng.

‚úÖ 6.4 ‚Äî Ki·ªÉm tra balances
BankA:
curl -s "http://localhost:8000/accounts/${BANKA_PUBLIC}" | jq '.balances'

BankB:
curl -s "http://localhost:8000/accounts/${BANKB_PUBLIC}" | jq '.balances'


K·ª≥ v·ªçng:

BankA t·ªïng USDX gi·∫£m 500

BankB t·ªïng USDX tƒÉng 500

üéâ XONG B∆Ø·ªöC 6

B√¢y gi·ªù b·∫°n g·ª≠i m√¨nh:

K·∫øt qu·∫£ khi ch·∫°y:

node scripts/transfer_banka_to_bankb.js 500
