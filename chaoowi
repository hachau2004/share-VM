COPY NGUY√äN FILE N√ÄY ‚Üí D√ÅN L·∫†I TO√ÄN B·ªò FILE transfer_banka_to_bankb.js

Ch·∫°y:

nano ~/stellar-dev/scripts/transfer_banka_to_bankb.js


Nh·∫•n Ctrl+A ‚Üí Delete ƒë·ªÉ x√≥a TR·∫ÆNG FILE.

D√°n to√†n b·ªô n·ªôi dung n√†y:

const S = require("stellar-sdk");
const fetch = global.fetch || require("node-fetch");

const HORIZON = process.env.HORIZON || "http://localhost:8000";

// Get correct horizon server constructor
let ServerClass =
  S.Server || (S.Horizon && S.Horizon.Server) || S.Horizon;
if (!ServerClass) {
  console.error(
    "Cannot find Server/Horizon constructor. stellar-sdk exports:",
    Object.keys(S).join(",")
  );
  process.exit(2);
}

// Build horizon client
let server;
try {
  server = new ServerClass(HORIZON, { allowHttp: true });
} catch (err) {
  try {
    server = new ServerClass(HORIZON);
  } catch (e) {
    console.error("Failed to init Horizon:", err.message || err);
    process.exit(3);
  }
}

(async () => {
  try {
    const FROM_SECRET = process.env.BANKA_SECRET;
    const TO_PUBLIC = process.env.BANKB_PUBLIC;
    const ISSUER_PUBLIC = process.env.ISSUER_PUBLIC;
    const AMOUNT = process.argv[2] || "100";

    if (!FROM_SECRET) {
      console.error("Missing BANKA_SECRET env");
      process.exit(1);
    }
    if (!TO_PUBLIC) {
      console.error("Missing BANKB_PUBLIC env");
      process.exit(1);
    }
    if (!ISSUER_PUBLIC) {
      console.error("Missing ISSUER_PUBLIC env");
      process.exit(1);
    }

    const fromKP = S.Keypair.fromSecret(FROM_SECRET);
    const account = await server.loadAccount(fromKP.publicKey());
    const asset = new S.Asset("USDX", ISSUER_PUBLIC);

    const baseFee = await server.fetchBaseFee();

    const tx = new S.TransactionBuilder(account, {
      fee: String(baseFee),
      networkPassphrase: "Standalone Network ; February 2017"
    })
      .addOperation(
        S.Operation.payment({
          destination: TO_PUBLIC,
          asset,
          amount: AMOUNT.toString()
        })
      )
      .setTimeout(30)
      .build();

    tx.sign(fromKP);

    const res = await server.submitTransaction(tx);
    console.log("Payment submitted successfully!");
    console.log("TX Hash:", res.hash);
    process.exit(0);
  } catch (e) {
    if (e.response && e.response.data) {
      console.error(
        "Horizon error:",
        JSON.stringify(e.response.data, null, 2)
      );
    } else {
      console.error("Error:", e.message || e);
    }
    process.exit(1);
  }
})();


L∆∞u file:
Ctrl + O ‚Üí Enter ‚Üí Ctrl + X

‚úÖ CH·∫†Y L·∫†I L·ªÜNH
node ~/stellar-dev/scripts/transfer_banka_to_bankb.js 500

‚ùó Quan tr·ªçng: tr∆∞·ªõc khi ch·∫°y, ph·∫£i export ENV
export HORIZON="http://localhost:8000"
export ISSUER_PUBLIC="$(jq -r .ISSUER_PUBLIC ~/stellar-dev/usdx-keys.json)"
export BANKA_SECRET="$(jq -r .BANKA_SECRET ~/stellar-dev/usdx-keys.json)"
export BANKB_PUBLIC="$(jq -r .BANKB_PUBLIC ~/stellar-dev/usdx-keys.json)"


Ki·ªÉm tra:

echo $BANKA_SECRET
echo $BANKB_PUBLIC
echo $ISSUER_PUBLIC




‚úÖ 6.3 ‚Äî Ch·∫°y chuy·ªÉn 500 USDX t·ª´ BankA ‚Üí BankB

Ch·∫°y:

node ~/stellar-dev/scripts/transfer_banka_to_bankb.js 500


K·∫øt qu·∫£ ƒë√∫ng s·∫Ω l√†:

Payment submitted, tx hash: XXXXXXXXXXXXXXXXXXXXX


=> L·ªánh ƒë√£ CHUY·ªÇN 500 USDX th√†nh c√¥ng.

‚úÖ 6.4 ‚Äî Ki·ªÉm tra balances
BankA:
curl -s "http://localhost:8000/accounts/${BANKA_PUBLIC}" | jq '.balances'

BankB:
curl -s "http://localhost:8000/accounts/${BANKB_PUBLIC}" | jq '.balances'


K·ª≥ v·ªçng:

BankA t·ªïng USDX gi·∫£m 500

BankB t·ªïng USDX tƒÉng 500

üéâ XONG B∆Ø·ªöC 6

B√¢y gi·ªù b·∫°n g·ª≠i m√¨nh:

K·∫øt qu·∫£ khi ch·∫°y:

node scripts/transfer_banka_to_bankb.js 500
