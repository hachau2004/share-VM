1 ‚Äî X√ìA C√ÅC B·∫¢N C≈® (amd64) ƒê√É T·∫¢I

Ch·∫°y c√°c l·ªánh n√†y ƒë·ªÉ d·ªçn d·∫πp (an to√†n):

# x√≥a go c≈©
sudo rm -rf /usr/local/go
rm -f ~/go1*.tar.gz

# x√≥a fabric binaries amd64 n·∫øu ƒë√£ gi·∫£i n√©n
rm -rf ~/fabric-samples/bin
rm -f ~/hyperledger-fabric-linux-amd64-*.tar.gz

# x√≥a fabric-ca amd64 n·∫øu c√≥
rm -f ~/hyperledger-fabric-ca-linux-amd64-*.tar.gz

2 ‚Äî C·∫¨P NH·∫¨T H·ªÜ TH·ªêNG & C√ÄI C√ÅC C√îNG C·ª§ C∆† B·∫¢N
sudo apt update
sudo apt upgrade -y
sudo apt install -y curl wget git ca-certificates apt-transport-https gnupg lsb-release jq

3 ‚Äî C√ÄI DOCKER + DOCKER COMPOSE (trong VM)

N·∫øu b·∫°n ƒëang d√πng Docker Desktop tr√™n macOS v√† mu·ªën Docker ·ªü host, b·ªè qua ph·∫ßn c√†i trong VM.
Trong VM Ubuntu ARM64:

# c√†i Docker (m·∫∑c ƒë·ªãnh apt may provide older package; d√πng repo ch√≠nh th·ª©c)
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

echo \
  "deb [arch=arm64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io

# cho ph√©p ch·∫°y docker kh√¥ng c·∫ßn sudo
sudo usermod -aG docker $USER
newgrp docker

# c√†i Docker Compose v2 plugin (ARM64 binary)
sudo mkdir -p /usr/local/lib/docker/cli-plugins
sudo curl -fSL "https://github.com/docker/compose/releases/latest/download/docker-compose-linux-aarch64" \
  -o /usr/local/lib/docker/cli-plugins/docker-compose
sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose

# ki·ªÉm tra
docker --version
docker compose version


N·∫øu docker run hello-world kh√¥ng ch·∫°y, b√°o l·ªói m√¨nh x·ª≠ l√Ω.

4 ‚Äî C√ÄI NODE.JS (ARM64)
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install -y nodejs
node -v
npm -v

5 ‚Äî C√ÄI GO CHO ARM64
# x√≥a /usr/local/go n·∫øu c√≤n (ƒë√£ l√†m ·ªü b∆∞·ªõc 1)
# t·∫£i Go cho arm64
wget https://go.dev/dl/go1.24.0.linux-arm64.tar.gz
sudo tar -C /usr/local -xzf go1.24.0.linux-arm64.tar.gz

# thi·∫øt l·∫≠p env (th√™m ch·ªâ n·∫øu ch∆∞a c√≥)
grep -q 'export GOROOT' ~/.bashrc || {
  echo "export GOROOT=/usr/local/go" >> ~/.bashrc
  echo "export GOPATH=\$HOME/go" >> ~/.bashrc
  echo "export PATH=\$PATH:/usr/local/go/bin:\$GOPATH/bin" >> ~/.bashrc
}
source ~/.bashrc

go version   # should show linux/arm64

6 ‚Äî L·∫§Y FABRIC-SAMPLES (project Bankchain s·∫Ω copy v√†o ƒë√¢y)
cd ~
git clone https://github.com/hyperledger/fabric-samples.git
cd fabric-samples

7 ‚Äî T·∫¢I BINARY HYPERLEDGER FABRIC (ARM64)
cd ~/fabric-samples
curl -LO https://github.com/hyperledger/fabric/releases/download/v3.1.0/hyperledger-fabric-linux-arm64-3.1.0.tar.gz
tar -xzf hyperledger-fabric-linux-arm64-3.1.0.tar.gz -C .
# ki·ªÉm tra
./bin/peer version
./bin/configtxgen version
./bin/cryptogen version
./bin/configtxlator version
./bin/osnadmin version


C√°c l·ªánh tr√™n ph·∫£i ch·∫°y kh√¥ng b√°o Exec format error v√† hi·ªÉn th·ªã linux/arm64.

8 ‚Äî T·∫¢I FABRIC-CA (ARM64)
cd ~/fabric-samples
curl -LO https://github.com/hyperledger/fabric-ca/releases/download/v1.5.10/hyperledger-fabric-ca-linux-arm64-1.5.10.tar.gz
tar -xzf hyperledger-fabric-ca-linux-arm64-1.5.10.tar.gz -C .
./bin/fabric-ca-client version

9 ‚Äî TH√äM PATH CHO BINARIES FABRIC
grep -q 'fabric-samples/bin' ~/.bashrc || {
  echo 'export PATH=$HOME/fabric-samples/bin:$PATH' >> ~/.bashrc
  echo 'export FABRIC_CFG_PATH=$HOME/fabric-samples/config' >> ~/.bashrc
}
source ~/.bashrc

which peer
peer version

10 ‚Äî L·∫§Y SOURCE BANKCHAIN (s√°ch b·∫°n ƒë√£ c√≥)
cd ~
git clone https://github.com/PacktPublishing/Blockchain-Development-for-Finance-Projects.git
cp -r Blockchain-Development-for-Finance-Projects/Chapter4/bankchain ~/fabric-samples/bankchain
cd ~/fabric-samples/bankchain

11 ‚Äî S·ª¨A DOCKER-COMPOSE FILE CHO ARM64 (n·∫øu c·∫ßn)

M·ªü docker-compose-bankchain.yaml, docker-compose-ca.yaml, docker-compose-couch.yaml.
T√¨m m·ªçi ch·ªó image: hyperledger/fabric-<name>:3.1 (ho·∫∑c :1.5.10) v√† th√™m h·∫≠u t·ªë -arm64 n·∫øu t·ªìn t·∫°i tag arm64 tr√™n hub.
V√≠ d·ª• thay:

image: hyperledger/fabric-peer:3.1


b·∫±ng

image: hyperledger/fabric-peer:3.1-arm64


L∆ØU √ù: M·ªôt s·ªë image c√≥ multi-arch manifests (t·ª± ch·ªçn), nh∆∞ng ƒë·ªÉ an to√†n ta ƒë·ªïi sang tag -arm64 n·∫øu c√≥. N·∫øu repo c·ªßa b·∫°n kh√¥ng c√≥ -arm64 image, ta c√≥ 2 l·ª±a ch·ªçn:

d√πng image multi-arch (b·ªè s·ª≠a) ‚Äî Docker t·ª± ch·ªçn image ph√π h·ª£p

ho·∫∑c ch·ªâ ƒë·ªãnh platform: linux/arm64 trong compose service, v√≠ d·ª•:

services:
  peer0.banka.bankchain.com:
    platform: linux/arm64
    image: hyperledger/fabric-peer:3.1
    ...


N·∫øu b·∫°n mu·ªën, m√¨nh s·∫Ω t·ª± s·ª≠a file cho b·∫°n ‚Äî nh∆∞ng c·∫ßn b·∫°n cho m√¨nh xem n·ªôi dung docker-compose-bankchain.yaml. (B·∫°n c√≥ th·ªÉ copy-paste ƒëo·∫°n services: ch√≠nh.)

12 ‚Äî T·∫¢I DOCKER IMAGES (ARM64)

T√πy tr∆∞·ªùng h·ª£p b·∫°n d√πng tag -arm64 hay platform. D∆∞·ªõi ƒë√¢y c√°ch chung:

# pull phi√™n b·∫£n ARM64 n·∫øu c√≥
docker pull hyperledger/fabric-peer:3.1-arm64 || true
docker pull hyperledger/fabric-orderer:3.1-arm64 || true
docker pull hyperledger/fabric-ccenv:3.1-arm64 || true
docker pull hyperledger/fabric-ca:1.5.10-arm64 || true

# n·∫øu kh√¥ng c√≥ tag -arm64, ƒë·ªÉ docker t·ª± resolve multi-arch:
docker pull hyperledger/fabric-peer:3.1 || true


Ki·ªÉm tra images:

docker images | grep hyperledger

13 ‚Äî T·∫†O CRYPTO (cryptogen)

Ch·∫°y trong th∆∞ m·ª•c bankchain:

cd ~/fabric-samples/bankchain

# ƒë·∫£m b·∫£o d√πng cryptogen t·ª´ bin
export PATH=$HOME/fabric-samples/bin:$PATH
cryptogen version

# generate certificates
cryptogen generate --config=./crypto-config.yaml --output=./crypto-config


‚úÖ K·∫øt qu·∫£: th∆∞ m·ª•c crypto-config/ v·ªõi MSP, TLS cho orderer & peers.

14 ‚Äî T·∫†O CHANNEL ARTIFACTS (configtxgen)
export FABRIC_CFG_PATH=$PWD
mkdir -p channel-artifacts

configtxgen -profile BankChannel -channelID bankchannel -outputBlock ./channel-artifacts/bankchannel.block


Ki·ªÉm tra file:

ls -l channel-artifacts/bankchannel.block

15 ‚Äî FIX l·ªói VOLUME orderer (n·∫øu xu·∫•t hi·ªán)

N·∫øu khi ch·∫°y orderer container g·∫∑p l·ªói cannot mount volume over existing file /etc/hyperledger/fabric, t·∫°o file dummy:

cd ~/fabric-samples/bankchain
touch dummy_fabric
mkdir -p orderer-config


T·∫°o file orderer-config/orderer.yaml t·ªëi thi·ªÉu (n·∫øu docker-compose tham chi·∫øu):

cat > orderer-config/orderer.yaml <<'YAML'
General:
  LocalMSPDir: /var/hyperledger/orderer/msp
  LocalMSPID: OrdererMSP
  ListenAddress: 0.0.0.0
  ListenPort: 7050
  TLS:
    Enabled: true
    PrivateKey: /var/hyperledger/orderer/tls/server.key
    Certificate: /var/hyperledger/orderer/tls/server.crt
    RootCAs:
      - /var/hyperledger/orderer/tls/ca.crt
ChannelParticipation:
  Enabled: true
Operations:
  ListenAddress: 0.0.0.0:9445
YAML

16 ‚Äî KH·ªûI ƒê·ªòNG ORDERER (docker compose)
docker compose -f docker-compose-bankchain.yaml up -d orderer.bankchain.com
# ki·ªÉm tra logs
docker logs --tail=200 orderer.bankchain.com


N·∫øu orderer crash: d√°n log v√†o ƒë√¢y. N·∫øu orderer up, ti·∫øp b∆∞·ªõc sau.

17 ‚Äî JOIN ORDERER V√ÄO CHANNEL (osnadmin)
# t·ª´ th∆∞ m·ª•c bankchain
osnadmin channel join --channelID bankchannel \
  --config-block ./channel-artifacts/bankchannel.block \
  -o orderer.bankchain.com:9443 \
  --ca-file crypto-config/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/ca.crt \
  --client-cert crypto-config/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/server.crt \
  --client-key crypto-config/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/server.key


Ki·ªÉm tra:

osnadmin channel list -o orderer.bankchain.com:9443 \
  --ca-file crypto-config/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/ca.crt \
  --client-cert crypto-config/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/server.crt \
  --client-key crypto-config/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/server.key


Trong list s·∫Ω th·∫•y bankchannel.

18 ‚Äî KH·ªûI ƒê·ªòNG PEERS + CLI
docker compose -f docker-compose-bankchain.yaml up -d \
  peer0.banka.bankchain.com peer1.banka.bankchain.com \
  peer0.bankb.bankchain.com peer1.bankb.bankchain.com \
  cli


Ki·ªÉm tra c√°c container:

docker ps --format 'table {{.Names}}\t{{.Status}}' | grep -E 'orderer|peer|cli|ca|couch'

19 ‚Äî JOIN PEER V√ÄO CHANNEL (b·∫±ng cli container)

V√†o shell cli:

docker exec -it cli bash


Trong shell cli (b√™n trong container):

Bank A peer0

export CHANNEL=bankchannel
export CORE_PEER_TLS_ENABLED=true
export CORE_PEER_LOCALMSPID=BankAMSP
export CORE_PEER_MSPCONFIGPATH=/opt/crypto/peerOrganizations/banka.bankchain.com/users/Admin@banka.bankchain.com/msp
export CORE_PEER_ADDRESS=peer0.banka.bankchain.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/crypto/peerOrganizations/banka.bankchain.com/peers/peer0.banka.bankchain.com/tls/ca.crt

peer channel join -b /opt/channel-artifacts/bankchannel.block


Bank A peer1

export CORE_PEER_ADDRESS=peer1.banka.bankchain.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/crypto/peerOrganizations/banka.bankchain.com/peers/peer1.banka.bankchain.com/tls/ca.crt

peer channel join -b /opt/channel-artifacts/bankchannel.block


Bank B peer0

export CORE_PEER_LOCALMSPID=BankBMSP
export CORE_PEER_MSPCONFIGPATH=/opt/crypto/peerOrganizations/bankb.bankchain.com/users/Admin@bankb.bankchain.com/msp
export CORE_PEER_ADDRESS=peer0.bankb.bankchain.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/crypto/peerOrganizations/bankb.bankchain.com/peers/peer0.bankb.bankchain.com/tls/ca.crt

peer channel join -b /opt/channel-artifacts/bankchannel.block


Bank B peer1

export CORE_PEER_ADDRESS=peer1.bankb.bankchain.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/crypto/peerOrganizations/bankb.bankchain.com/peers/peer1.bankb.bankchain.com/tls/ca.crt

peer channel join -b /opt/channel-artifacts/bankchannel.block


Ki·ªÉm tra:

peer channel list
peer channel getinfo -c bankchannel

20 ‚Äî C·∫¨P NH·∫¨T ANCHOR PEERS (Bank A, Bank B)

V·∫´n trong cli:

Chu·∫©n b·ªã bi·∫øn:

export CHANNEL=bankchannel
export ORDERER_ADDR=orderer.bankchain.com:7050
export ORDERER_CA=/opt/crypto/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/ca.crt
export FABRIC_CFG_PATH=/etc/hyperledger/fabric


BANK A

peer channel fetch config /opt/channel-artifacts/config_block.pb -c $CHANNEL -o $ORDERER_ADDR --tls --cafile $ORDERER_CA

configtxlator proto_decode --input /opt/channel-artifacts/config_block.pb --type common.Block \
  | jq '.data.data[0].payload.data.config' > /opt/channel-artifacts/config.json

configtxlator proto_encode --input /opt/channel-artifacts/config.json --type common.Config > /opt/channel-artifacts/config.pb

jq '.channel_group.groups.Application.groups.BankAMSP.values.AnchorPeers =
{"mod_policy":"Admins","value":{"anchor_peers":[{"host":"peer0.banka.bankchain.com","port":7051}]},"version":"0"}' \
  /opt/channel-artifacts/config.json > /opt/channel-artifacts/modified_config_bankA.json

configtxlator proto_encode --input /opt/channel-artifacts/modified_config_bankA.json --type common.Config \
  > /opt/channel-artifacts/modified_config_bankA.pb

configtxlator compute_update --channel_id $CHANNEL --original /opt/channel-artifacts/config.pb \
  --updated /opt/channel-artifacts/modified_config_bankA.pb --output /opt/channel-artifacts/anchors_update_bankA.pb

configtxlator proto_decode --input /opt/channel-artifacts/anchors_update_bankA.pb --type common.ConfigUpdate \
  | jq -n --slurpfile upd /dev/stdin '{"payload":{"header":{"channel_header":{"channel_id":env.CHANNEL,"type":2}},"data":{"config_update":$upd[0]}}}' \
  > /opt/channel-artifacts/anchors_update_bankA_envelope.json

configtxlator proto_encode --input /opt/channel-artifacts/anchors_update_bankA_envelope.json --type common.Envelope \
  > /opt/channel-artifacts/anchors_update_bankA_envelope.pb

# g·ª≠i update v·ªõi Admin Bank A
export CORE_PEER_LOCALMSPID=BankAMSP
export CORE_PEER_MSPCONFIGPATH=/opt/crypto/peerOrganizations/banka.bankchain.com/users/Admin@banka.bankchain.com/msp
export CORE_PEER_ADDRESS=peer0.banka.bankchain.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/crypto/peerOrganizations/banka.bankchain.com/peers/peer0.banka.bankchain.com/tls/ca.crt
peer channel update -f /opt/channel-artifacts/anchors_update_bankA_envelope.pb -c $CHANNEL -o $ORDERER_ADDR --tls --cafile $ORDERER_CA


BANK B (t∆∞∆°ng t·ª±, ƒë·ªïi host/paths v√† MSP t√™n):

# fetch config (nh∆∞ tr√™n), modify .BankBMSP..., compute_update, b·ªçc envelope, r·ªìi:
export CORE_PEER_LOCALMSPID=BankBMSP
export CORE_PEER_MSPCONFIGPATH=/opt/crypto/peerOrganizations/bankb.bankchain.com/users/Admin@bankb.bankchain.com/msp
export CORE_PEER_ADDRESS=peer0.bankb.bankchain.com:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/crypto/peerOrganizations/bankb.bankchain.com/peers/peer0.bankb.bankchain.com/tls/ca.crt
peer channel update -f /opt/channel-artifacts/anchors_update_bankB_envelope.pb -c $CHANNEL -o $ORDERER_ADDR --tls --cafile $ORDERER_CA


X√°c nh·∫≠n:

peer channel fetch config /opt/channel-artifacts/config_block.pb -c $CHANNEL -o $ORDERER_ADDR --tls --cafile $ORDERER_CA
configtxlator proto_decode --input /opt/channel-artifacts/config_block.pb --type common.Block \
  | jq '.data.data[0].payload.data.config.channel_group.groups.Application.groups.BankAMSP.values.AnchorPeers,
       .data.data[0].payload.data.config.channel_group.groups.Application.groups.BankBMSP.values.AnchorPeers'


B·∫°n s·∫Ω th·∫•y anchor_peers ƒë√∫ng host/port.


PH·∫¶N 4.1 ‚Äì B∆Ø·ªöC 4
‚úÖ START FABRIC CA

Di chuy·ªÉn v√†o bankchain:

cd ~/fabric-samples/bankchain


Ch·∫°y CA containers tr∆∞·ªõc (ARM64 compatible):

docker-compose -f docker-compose-ca.yaml up -d

‚úÖ K·ª≥ v·ªçng:

2 CA kh·ªüi ch·∫°y:

ca.banka.bankchain.com

ca.bankb.bankchain.com

‚úÖ B∆Ø·ªöC 5 ‚Äî KH·ªûI ƒê·ªòNG ORDERER
docker-compose -f docker-compose-bankchain.yaml up -d orderer.bankchain.com


Ki·ªÉm tra:

docker ps


B·∫°n ph·∫£i th·∫•y container orderer ch·∫°y.

‚úÖ B∆Ø·ªöC 6 ‚Äî T·∫†O CHANNEL (CLI)

Tr∆∞·ªõc ti√™n v√†o CLI container:

docker exec -it cli.bankchain.com bash


B√™n trong container CLI, ch·∫°y:

peer channel create -o orderer.bankchain.com:7050 \
    -c bankchannel \
    -f ./channel-artifacts/channel.tx \
    --outputBlock ./channel-artifacts/bankchannel.block


K·∫øt qu·∫£ ƒë√∫ng:

‚úÖ bankchannel.block ƒë∆∞·ª£c t·∫°o trong container CLI.

‚úÖ B∆Ø·ªöC 7 ‚Äî JOIN PEER BANK A

Trong CLI container:

export CORE_PEER_LOCALMSPID=BankAMSP
export CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/msp/admincerts/banka
export CORE_PEER_ADDRESS=peer0.banka.bankchain.com:7051


Join:

peer channel join -b ./channel-artifacts/bankchannel.block


‚úÖ K·∫øt qu·∫£: Successfully submitted proposal to join channel

‚úÖ B∆Ø·ªöC 8 ‚Äî JOIN PEER BANK B

V·∫´n trong CLI:

export CORE_PEER_LOCALMSPID=BankBMSP
export CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/msp/admincerts/bankb
export CORE_PEER_ADDRESS=peer0.bankb.bankchain.com:8051


Join:

peer channel join -b ./channel-artifacts/bankchannel.block

‚úÖ B∆Ø·ªöC 9 ‚Äî UPDATE ANCHOR PEERS
Bank A:
export CORE_PEER_LOCALMSPID=BankAMSP
export CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/msp/admincerts/banka
export CORE_PEER_ADDRESS=peer0.banka.bankchain.com:7051

peer channel update -o orderer.bankchain.com:7050 \
  -c bankchannel \
  -f ./channel-artifacts/bankaMSPanchors.tx

Bank B:
export CORE_PEER_LOCALMSPID=BankBMSP
export CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/msp/admincerts/bankb
export CORE_PEER_ADDRESS=peer0.bankb.bankchain.com:8051

peer channel update -o orderer.bankchain.com:7050 \
  -c bankchannel \
  -f ./channel-artifacts/bankbMSPanchors.tx

‚úÖ GI·ªú T·ªöI L∆Ø·ª¢T B·∫†N:

üëâ L√†m 3 b∆∞·ªõc v√† g·ª≠i m√¨nh h√¨nh:

‚úÖ 1. Ch·∫°y:

docker-compose -f docker-compose-ca.yaml up -d


‚Üí G·ª≠i ·∫£nh docker ps

‚úÖ 2. Ch·∫°y:

docker-compose -f docker-compose-bankchain.yaml up -d orderer.bankchain.com


‚Üí G·ª≠i ·∫£nh docker ps

‚úÖ 3. V√†o CLI:

docker exec -it cli.bankchain.com bash


‚Üí G·ª≠i ·∫£nh n·∫øu v√†o ƒë∆∞·ª£c CLI

