🧱 Bước 2 — Generate channel artifacts

Tạo file genesis block cho channel:

configtxgen -configPath $PWD \
  -profile BankchainGenesis \
  -channelID bkchannel \
  -outputBlock ./channel-artifacts/bkchannel.block


Sau đó tạo anchor peer update:

configtxgen -configPath $PWD -profile BankChannel -channelID bkchannel \
  -asOrg BankAMSP -outputAnchorPeersUpdate ./channel-artifacts/BankAMSPanchors.tx

configtxgen -configPath $PWD -profile BankChannel -channelID bkchannel \
  -asOrg BankBMSP -outputAnchorPeersUpdate ./channel-artifacts/BankBMSPanchors.tx

🐳 Bước 3 — Docker Compose (khởi động toàn bộ network)

Kéo image (để tránh lỗi version):

export IMAGE_TAG=3.1
export CA_IMAGE_TAG=1.5.10

docker pull ghcr.io/hyperledger/fabric-peer:$IMAGE_TAG
docker pull ghcr.io/hyperledger/fabric-orderer:$IMAGE_TAG
docker pull couchdb:3.3
docker pull ghcr.io/hyperledger/fabric-ca:$CA_IMAGE_TAG


Sau đó khởi động toàn bộ:

Chạy lần lượt:

sudo apt update
sudo apt install docker-compose -y


Sau đó kiểm tra:

docker-compose version


Nếu thấy trả về như:

docker-compose version 1.29.2, build ...


→ là OK ✅

Rồi bạn chạy lại lệnh:

docker-compose \
  -f docker-compose-bankchain.yaml \
  -f docker-compose-ca.yaml \
  -f docker-compose-couch.yaml \
  up -d



🧾 Kiểm tra:

docker ps


→ Bạn nên thấy khoảng 10–11 container đang chạy (peer0/1, orderer, ca, cli, couchdb...)

⛓ Bước 4 — Tạo channel & test
(a) Copy genesis block vào orderer
docker cp ./channel-artifacts/bkchannel.block orderer.bankchain.com:/var/hyperledger/orderer/bkchannel.block

(b) Orderer join channel
docker exec -it orderer.bankchain.com bash -lc \
'osnadmin channel join \
  --channelID bkchannel \
  --config-block /var/hyperledger/orderer/bkchannel.block \
  -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key'


Kiểm tra:

docker exec orderer.bankchain.com osnadmin channel list -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key

(c) Peer join channel (từ container CLI)
docker exec -it cli bash


→ Trong CLI container, chạy lần lượt các lệnh:

export CHANNEL_NAME=bkchannel
export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/ca.crt


Rồi chạy tiếp các lệnh peer channel join cho từng peer (như hướng dẫn của bạn gửi).
