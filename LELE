BÆ°á»›c 2: Táº¡o láº¡i file bá»‹ thiáº¿u

Cháº¡y lá»‡nh:

nano base/docker-compose-base-bankchain.yaml


Rá»“i dÃ¡n ná»™i dung máº«u dÆ°á»›i Ä‘Ã¢y vÃ o file:

version: '2'

services:
  orderer.bankchain.com:
    container_name: orderer.bankchain.com
    image: ghcr.io/hyperledger/fabric-orderer:${IMAGE_TAG}
    environment:
      - ORDERER_GENERAL_LOGLEVEL=info
      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0
      - ORDERER_GENERAL_GENESISMETHOD=file
      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block
      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP
      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp
      - ORDERER_GENERAL_TLS_ENABLED=true
      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key
      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt
      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]
    working_dir: /opt/gopath/src/github.com/hyperledger/fabric
    command: orderer
    volumes:
      - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block
      - ./crypto-config/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/msp:/var/hyperledger/orderer/msp
      - ./crypto-config/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/:/var/hyperledger/orderer/tls
    ports:
      - 7050:7050

  peer0.banka.bankchain.com:
    container_name: peer0.banka.bankchain.com
    image: ghcr.io/hyperledger/fabric-peer:${IMAGE_TAG}
    environment:
      - CORE_PEER_ID=peer0.banka.bankchain.com
      - CORE_PEER_ADDRESS=peer0.banka.bankchain.com:7051
      - CORE_PEER_LISTENADDRESS=0.0.0.0:7051
      - CORE_PEER_LOCALMSPID=BankAMSP
      - CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/msp
      - CORE_PEER_TLS_ENABLED=true
      - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt
      - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key
      - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt
    volumes:
      - ./crypto-config/peerOrganizations/banka.bankchain.com/peers/peer0.banka.bankchain.com/msp:/etc/hyperledger/fabric/msp
      - ./crypto-config/peerOrganizations/banka.bankchain.com/peers/peer0.banka.bankchain.com/tls:/etc/hyperledger/fabric/tls
    ports:
      - 7051:7051


LÆ°u láº¡i báº±ng:

Ctrl + O â†’ Enter
Ctrl + X

BÆ°á»›c 3: Cháº¡y láº¡i lá»‡nh compose
export SYS_CHANNEL=bk-sys-channel
docker compose \
  -f docker-compose-bankchain.yaml \
  -f docker-compose-ca.yaml \
  -f docker-compose-couch.yaml \
  up -d


ðŸ“¸ Sau khi cháº¡y, gá»­i mÃ¬nh áº£nh cá»§a:

ls base


vÃ 

docker ps

â›“ BÆ°á»›c 4 â€” Táº¡o channel & test
(a) Copy genesis block vÃ o orderer
docker cp ./channel-artifacts/bkchannel.block orderer.bankchain.com:/var/hyperledger/orderer/bkchannel.block

(b) Orderer join channel
docker exec -it orderer.bankchain.com bash -lc \
'osnadmin channel join \
  --channelID bkchannel \
  --config-block /var/hyperledger/orderer/bkchannel.block \
  -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key'


Kiá»ƒm tra:

docker exec orderer.bankchain.com osnadmin channel list -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key

(c) Peer join channel (tá»« container CLI)
docker exec -it cli bash


â†’ Trong CLI container, cháº¡y láº§n lÆ°á»£t cÃ¡c lá»‡nh:

export CHANNEL_NAME=bkchannel
export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/ca.crt


Rá»“i cháº¡y tiáº¿p cÃ¡c lá»‡nh peer channel join cho tá»«ng peer (nhÆ° hÆ°á»›ng dáº«n cá»§a báº¡n gá»­i).

sudo curl -L "https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

docker-compose \
  -f docker-compose-bankchain.yaml \
  -f docker-compose-ca.yaml \
  -f docker-compose-couch.yaml \
  up -d

