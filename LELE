üß± B∆∞·ªõc 2 ‚Äî Generate channel artifacts

T·∫°o file genesis block cho channel:

configtxgen -configPath $PWD \
  -profile BankchainGenesis \
  -channelID bkchannel \
  -outputBlock ./channel-artifacts/bkchannel.block


Sau ƒë√≥ t·∫°o anchor peer update:

configtxgen -configPath $PWD -profile BankChannel -channelID bkchannel \
  -asOrg BankAMSP -outputAnchorPeersUpdate ./channel-artifacts/BankAMSPanchors.tx

configtxgen -configPath $PWD -profile BankChannel -channelID bkchannel \
  -asOrg BankBMSP -outputAnchorPeersUpdate ./channel-artifacts/BankBMSPanchors.tx

üê≥ B∆∞·ªõc 3 ‚Äî Docker Compose (kh·ªüi ƒë·ªông to√†n b·ªô network)

K√©o image (ƒë·ªÉ tr√°nh l·ªói version):

export IMAGE_TAG=3.1
export CA_IMAGE_TAG=1.5.10

docker pull ghcr.io/hyperledger/fabric-peer:$IMAGE_TAG
docker pull ghcr.io/hyperledger/fabric-orderer:$IMAGE_TAG
docker pull couchdb:3.3
docker pull ghcr.io/hyperledger/fabric-ca:$CA_IMAGE_TAG


Sau ƒë√≥ kh·ªüi ƒë·ªông to√†n b·ªô:

1Ô∏è‚É£ G·ª° s·∫°ch nh·ªØng g√≥i compose b·ªã tr√πng

sudo apt remove docker-compose docker-compose-plugin docker-compose-v2 -y


2Ô∏è‚É£ C√†i l·∫°i plugin ch√≠nh th·ª©c t·ª´ Docker

sudo apt update
sudo apt install docker-compose-plugin -y


3Ô∏è‚É£ Ki·ªÉm tra l·∫°i

docker compose version


‚ö†Ô∏è L∆∞u √Ω: c√∫ ph√°p b√¢y gi·ªù l√† docker compose (c√≥ d·∫•u c√°ch) ch·ª© kh√¥ng c√≤n l√† docker-compose (c√≥ d·∫•u g·∫°ch n·ªëi) n·ªØa.

4Ô∏è‚É£ Sau khi c√≥ k·∫øt qu·∫£ version OK, ch·∫°y l·∫°i l·ªánh n√†y ƒë·ªÉ kh·ªüi ƒë·ªông m·∫°ng Bankchain:

docker compose \
  -f docker-compose-bankchain.yaml \
  -f docker-compose-ca.yaml \
  -f docker-compose-couch.yaml \
  up -d



üßæ Ki·ªÉm tra:

docker ps


‚Üí B·∫°n n√™n th·∫•y kho·∫£ng 10‚Äì11 container ƒëang ch·∫°y (peer0/1, orderer, ca, cli, couchdb...)

‚õì B∆∞·ªõc 4 ‚Äî T·∫°o channel & test
(a) Copy genesis block v√†o orderer
docker cp ./channel-artifacts/bkchannel.block orderer.bankchain.com:/var/hyperledger/orderer/bkchannel.block

(b) Orderer join channel
docker exec -it orderer.bankchain.com bash -lc \
'osnadmin channel join \
  --channelID bkchannel \
  --config-block /var/hyperledger/orderer/bkchannel.block \
  -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key'


Ki·ªÉm tra:

docker exec orderer.bankchain.com osnadmin channel list -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key

(c) Peer join channel (t·ª´ container CLI)
docker exec -it cli bash


‚Üí Trong CLI container, ch·∫°y l·∫ßn l∆∞·ª£t c√°c l·ªánh:

export CHANNEL_NAME=bkchannel
export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/ca.crt


R·ªìi ch·∫°y ti·∫øp c√°c l·ªánh peer channel join cho t·ª´ng peer (nh∆∞ h∆∞·ªõng d·∫´n c·ªßa b·∫°n g·ª≠i).
