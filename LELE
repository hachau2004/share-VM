✅ ✅ FILE BASE CHUẨN (copy nguyên văn)
version: '2'

services:

  orderer.example.com:
    environment:
      - ORDERER_GENERAL_LOGLEVEL=INFO
      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0
      - ORDERER_GENERAL_GENESISMETHOD=file
      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP
      - ORDERER_GENERAL_TLS_ENABLED=true
      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key
      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt
      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]
    working_dir: /opt/hyperledger/orderer
    command: orderer

  peer-base:
    environment:
      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
      - CORE_VM_DOCKER_ATTACHSTDOUT=true
      - CORE_PEER_TLS_ENABLED=true
      - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt
      - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key
      - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt
      - CORE_PEER_FILESYSTEMPATH=/var/hyperledger/production
      - CORE_LEDGER_STATE_STATEDATABASE=CouchDB
    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    command: peer node start
    volumes:
      - /var/run/:/host/var/run/

  peer0.banka.example.com:
    extends:
      service: peer-base

  peer1.banka.example.com:
    extends:
      service: peer-base

  peer0.bankb.example.com:
    extends:
      service: peer-base

  peer1.bankb.example.com:
    extends:
      service: peer-base

✅ Giải thích
File base CHỈ CHỨA:

✅ cấu hình môi trường chung
✅ peer-base cho tất cả peer
✅ orderer-base

⛔ Không được chứa:

port

couchdb

TLS volumes

genesis.block

MSP

chaincode mount

scripts

extends từ chính nó

→ Những thứ đó thuộc file chủ docker-compose-bankchain.yaml.

✅ TIẾP THEO BẠN CẦN LÀM

✅ 1. Thay thế file base bạn đang dùng bằng file mình cung cấp
✅ 2. Giữ nguyên file compose chính
✅ 3. Chạy lại:

docker-compose -f docker-compose-bankchain.yaml up -d


Lưu lại.

✅ Bước 3 — Xóa container cũ để tránh lỗi lặp lại
docker rm -f $(docker ps -aq)
docker volume prune -f
docker network prune -f

✅ Bước 4 — Kiểm tra xem file base tồn tại
ls ~/fabric-samples/bankchain/base


Bạn phải thấy:

docker-compose-base-bankchain.yaml  peer-base.yaml

✅ Bước 5 — Chạy lại CA
docker compose -f docker-compose-ca.yaml up -d

✅ Bước 6 — Chạy lại network
docker compose -f docker-compose-bankchain.yaml up -d
