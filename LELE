🔧 Cách sửa lỗi “docker: unknown command: docker compose”
🪜 Bước 1: Kiểm tra Docker đã nhận plugin chưa

Chạy lệnh:

ls /usr/libexec/docker/cli-plugins/


Nếu bạn thấy có file tên:

docker-compose


→ Là plugin đã được cài đúng chỗ, nhưng Docker chưa nhận ra.

🪜 Bước 2: Kiểm tra đường dẫn CLI plugin

Chạy lệnh:

docker version


Ở cuối sẽ có dòng “Client:” → xem Docker Root Dir hoặc CLI Plugins Dir.
Nếu /usr/libexec/docker/cli-plugins không nằm trong đó, ta cần tạo symlink.

🪜 Bước 3: Tạo liên kết để Docker nhận Compose

Chạy lệnh sau:

sudo mkdir -p /usr/local/lib/docker/cli-plugins
sudo ln -s /usr/libexec/docker/cli-plugins/docker-compose /usr/local/lib/docker/cli-plugins/docker-compose

🪜 Bước 4: Kiểm tra lại

Giờ chạy lại lệnh:

docker compose version


Nếu ra ví dụ như:

Docker Compose version v2.24.0


→ ✅ OK rồi!

🪜 Bước 5: Chạy lại lệnh khởi động mạng Bankchain
docker compose \
  -f docker-compose-bankchain.yaml \
  -f docker-compose-ca.yaml \
  -f docker-compose-couch.yaml \
  up -d

⛓ Bước 4 — Tạo channel & test
(a) Copy genesis block vào orderer
docker cp ./channel-artifacts/bkchannel.block orderer.bankchain.com:/var/hyperledger/orderer/bkchannel.block

(b) Orderer join channel
docker exec -it orderer.bankchain.com bash -lc \
'osnadmin channel join \
  --channelID bkchannel \
  --config-block /var/hyperledger/orderer/bkchannel.block \
  -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key'


Kiểm tra:

docker exec orderer.bankchain.com osnadmin channel list -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key

(c) Peer join channel (từ container CLI)
docker exec -it cli bash


→ Trong CLI container, chạy lần lượt các lệnh:

export CHANNEL_NAME=bkchannel
export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/ca.crt


Rồi chạy tiếp các lệnh peer channel join cho từng peer (như hướng dẫn của bạn gửi).

sudo curl -L "https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

docker-compose \
  -f docker-compose-bankchain.yaml \
  -f docker-compose-ca.yaml \
  -f docker-compose-couch.yaml \
  up -d

