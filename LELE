2ï¸âƒ£ Náº¿u cryptogen vÃ  configtxgen chÆ°a Ä‘Æ°á»£c nháº­n, thÃªm vÃ o PATH:
export PATH=~/fabric-samples/bin:$PATH


âš™ï¸ (Lá»‡nh nÃ y giÃºp há»‡ thá»‘ng â€œbiáº¿tâ€ cÃ´ng cá»¥ cryptogen vÃ  configtxgen náº±m á»Ÿ Ä‘Ã¢u.)

3ï¸âƒ£ Thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng cáº¥u hÃ¬nh
export FABRIC_CFG_PATH=$PWD

ğŸš€ Báº¯t Ä‘áº§u 4 bÆ°á»›c khá»Ÿi cháº¡y network
ğŸ§© BÆ°á»›c 1 â€” Generate certificates

Sinh chá»©ng chá»‰ (MSP, TLS, v.v.) cho cÃ¡c tá»• chá»©c:

rm -rf crypto-config channel-artifacts && mkdir -p crypto-config channel-artifacts
cryptogen generate --config=./crypto-config.yaml --output=./crypto-config


Sau khi cháº¡y xong, gÃµ:

tree crypto-config


(náº¿u chÆ°a cÃ i tree thÃ¬ cháº¡y sudo apt install tree -y)
â†’ Báº¡n sáº½ tháº¥y thÆ° má»¥c chá»©a certs cho banka, bankb, vÃ  orderer.

ğŸ§± BÆ°á»›c 2 â€” Generate channel artifacts

Táº¡o file genesis block cho channel:

configtxgen -configPath $PWD \
  -profile BankchainGenesis \
  -channelID bkchannel \
  -outputBlock ./channel-artifacts/bkchannel.block


Sau Ä‘Ã³ táº¡o anchor peer update:

configtxgen -configPath $PWD -profile BankChannel -channelID bkchannel \
  -asOrg BankAMSP -outputAnchorPeersUpdate ./channel-artifacts/BankAMSPanchors.tx

configtxgen -configPath $PWD -profile BankChannel -channelID bkchannel \
  -asOrg BankBMSP -outputAnchorPeersUpdate ./channel-artifacts/BankBMSPanchors.tx

ğŸ³ BÆ°á»›c 3 â€” Docker Compose (khá»Ÿi Ä‘á»™ng toÃ n bá»™ network)

KÃ©o image (Ä‘á»ƒ trÃ¡nh lá»—i version):

export IMAGE_TAG=3.1
export CA_IMAGE_TAG=1.5.10

docker pull ghcr.io/hyperledger/fabric-peer:$IMAGE_TAG
docker pull ghcr.io/hyperledger/fabric-orderer:$IMAGE_TAG
docker pull couchdb:3.3
docker pull ghcr.io/hyperledger/fabric-ca:$CA_IMAGE_TAG


Sau Ä‘Ã³ khá»Ÿi Ä‘á»™ng toÃ n bá»™:

docker compose \
  -f docker-compose-bankchain.yaml \
  -f docker-compose-ca.yaml \
  -f docker-compose-couch.yaml \
  up -d


ğŸ§¾ Kiá»ƒm tra:

docker ps


â†’ Báº¡n nÃªn tháº¥y khoáº£ng 10â€“11 container Ä‘ang cháº¡y (peer0/1, orderer, ca, cli, couchdb...)

â›“ BÆ°á»›c 4 â€” Táº¡o channel & test
(a) Copy genesis block vÃ o orderer
docker cp ./channel-artifacts/bkchannel.block orderer.bankchain.com:/var/hyperledger/orderer/bkchannel.block

(b) Orderer join channel
docker exec -it orderer.bankchain.com bash -lc \
'osnadmin channel join \
  --channelID bkchannel \
  --config-block /var/hyperledger/orderer/bkchannel.block \
  -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key'


Kiá»ƒm tra:

docker exec orderer.bankchain.com osnadmin channel list -o localhost:7053 \
  --ca-file /var/hyperledger/orderer/tls/ca.crt \
  --client-cert /var/hyperledger/orderer/tls/server.crt \
  --client-key /var/hyperledger/orderer/tls/server.key

(c) Peer join channel (tá»« container CLI)
docker exec -it cli bash


â†’ Trong CLI container, cháº¡y láº§n lÆ°á»£t cÃ¡c lá»‡nh:

export CHANNEL_NAME=bkchannel
export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/bankchain.com/orderers/orderer.bankchain.com/tls/ca.crt


Rá»“i cháº¡y tiáº¿p cÃ¡c lá»‡nh peer channel join cho tá»«ng peer (nhÆ° hÆ°á»›ng dáº«n cá»§a báº¡n gá»­i).
