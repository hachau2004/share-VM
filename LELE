✅ 1. Vào container CLI
✅ 2. KHẮC PHỤC – KHỞI ĐỘNG LẠI MẠNG FABRIC ĐÚNG CÁCH
✅ Bước 1: Xóa toàn bộ container, network, volume cũ

Chạy lệnh:

docker compose -f docker-compose-bankchain.yaml down -v
docker compose -f docker-compose-ca.yaml down -v


Nếu muốn chắc chắn sạch hoàn toàn:

docker system prune -af
docker volume prune -f

✅ Bước 2: Khởi động lại CA trước

Rất quan trọng: Phải bật CA trước, vì CA sinh certificate cho peer/orderer.

Chạy:

docker compose -f docker-compose-ca.yaml up -d


✅ Sau đó kiểm tra:

docker ps


→ Bạn phải thấy 2 container ca_peerbanka và ca_peerbankb đang Up.

Nếu chúng vẫn Exited → mình sẽ giúp fix.

✅ Bước 3: Khởi động network chính

Khi CA đã chạy OK:

docker compose -f docker-compose-bankchain.yaml up -d


✅ Kiểm tra:

docker ps


→ Bạn phải nhìn thấy:

Container	STATUS
peer0.banka	Up
peer1.banka	Up
peer0.bankb	Up
peer1.bankb	Up
orderer	Up
couchdb0-3	Up
cli	Up
✅ Bước 4: Exec vào CLI

Khi container cli đang Up:

docker exec -it cli bash

Chạy:

docker exec -it cli bash


Bạn sẽ thấy prompt như:

root@cli:/opt/gopath/src/github.com/hyperledger/fabric/peer#

✅ 2. Export biến môi trường cho Peer0 Bank A

Chạy từng dòng:

export CORE_PEER_LOCALMSPID="bankaMSP"
export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/banka.example.com/users/Admin@banka.example.com/msp
export CORE_PEER_ADDRESS=peer0.banka.example.com:7051
export CORE_PEER_TLS_ENABLED=true
export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/banka.example.com/peers/peer0.banka.example.com/tls/ca.crt

✅ 3. Tạo Channel (bankchannel)

Chạy:

export CHANNEL_NAME=bankchannel


Rồi tạo channel:

peer channel create \
  -o orderer.example.com:7050 \
  -c $CHANNEL_NAME \
  -f ./channel-artifacts/channel.tx \
  --outputBlock ./channel-artifacts/bankchannel.block \
  --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt


✅ Nếu thành công sẽ hiện:

INFO Successfully created channel bankchannel

✅ 4. Join Peer0 Bank A vào Channel
peer channel join -b ./channel-artifacts/bankchannel.block
